const _0x13c5aa=_0x46ab;function _0x26e1(){const _0x2938be=['》的批量编纂任务已完成。成功:\x20','hly-include-user','style','\x20个Rerank模型。','宝库已清空。','apiKey','hly-manual-text','querySelectorAll','\x20个局部知识库吗？此操作无法恢复！','totalVectors','通行令牌\x20(API\x20Key):','移动知识库\x20','删除失败:\x20','预览内容已更新，可随时开始凝识。','chunkSize','sources','{{chat_text}}','signal','】移动到【','\x20个知识块','hly-locked-status','saveHLYSettings','target','\x20个局部知识库均已成功删除。','removeEventListener','24392079XYxPbE','.hly-hist-entry-checkbox','任务完成！成功录入\x20','\x0a</pre>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','tags','[翰林院-枢纽]\x20编纂过程发生严重错误:','\x20失败:\x20','翰林院启奏','localToGlobal','【手动存档】所有设定已存档封印。','圣旨已下','checkbox','您确定要永久删除【当前角色】的全部\x20','hly-unified-injection-depth','clearJob','>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22hly-toggle-slider\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22hly-kb-delete-btn\x22\x20title=\x22删除此知识库\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','已采集\x20','novel','rerank','getVectorCount','checked','[翰林院-枢纽]\x20加载书库列表失败:','3174224fiPGcE','fa-exclamation-triangle','400393eayTjI',')\x20已被删除','getChatId','processed','hly-kb-delete-btn','hly-rerank-model','\x20条消息，开始凝识...','会话已解锁，将跟随当前角色。','previousElementSibling','message','翰林院使用教程','未检测到预览文本，按标准流程采集消息...','hly-retrieval-enabled','val','\x20楼:\x20[','local_proxy','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<details\x20class=\x22hly-preview-details\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<summary\x20class=\x22hly-preview-summary\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20第\x20','\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20data-send-date=\x22','解锁会话','scrollTop','every','change','hly-layer-end','processCondensation','hlyLog','[翰林院-枢纽]\x20未能获取SillyTavern上下文，绑定失败。','。进度已保存，可稍后重试。','embeddingModel','\x20个条目进行编纂...','\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20data-is-user=\x22','is_user','[data-setting-key]','delete','hly-api-key',')\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20class=\x22hly-hist-entry-checkbox\x22\x20value=\x22','.hly-hist-entry-checkbox:checked','purgeStorage','未找到符合条件的消息。','6166232nFXMeX','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22hly-add-rule-btn\x22\x20class=\x22hly-action-button\x22\x20style=\x22margin-top:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-plus\x22></i>\x20添加新规则\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.hly-exclusion-rule-row\x20{\x20display:\x20flex;\x20align-items:\x20center;\x20gap:\x2010px;\x20margin-bottom:\x2010px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.hly-exclusion-rule-row\x20input\x20{\x20flex-grow:\x201;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.hly-delete-rule-btn\x20{\x20background:\x20#c0392b;\x20color:\x20white;\x20border:\x20none;\x20border-radius:\x2050%;\x20width:\x2024px;\x20height:\x2024px;\x20cursor:\x20pointer;\x20font-size:\x2016px;\x20line-height:\x2024px;\x20text-align:\x20center;\x20padding:\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20</style>\x0a\x20\x20\x20\x20','批量编纂任务已完成。','请输入您的Google\x20API\x20Key','toggleSessionLock','hly-hist-entry-multiselect-btn','find','startHLYHistoriography','当前角色','log-error','disabled','getGlobalKnowledgeBases','\x20条忆识。','\x22\x20placeholder=\x22开始字符,\x20如\x20<!--\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>到</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20class=\x22hly-imperial-brush\x22\x20value=\x22','injection_','log-warn','is-user','allEntries','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22hly-toggle-switch\x22\x20title=\x22启用/禁用此知识库\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20class=\x22hly-kb-toggle\x22\x20',',\x20忆识总数=','querySelector','所有\x20','hly-rerank-url','hly-condensation-results','createElement','hly-','》的条目失败:','错误:\x20','hly-exclusion-rules-btn','\x20个知识库从【','startHLYCondensation','收到手动录入请求，文本长度:\x20','此操作将彻底清空当前角色的所有忆识（向量），且无法恢复。您确定要继续吗？','翰林院设定已存档封印。','send-date','hly-current-chat-id','hanlinyuan-ingest-progress-container','use\x20strict','manual','<div\x20class=\x22hly-no-results\x22>未找到匹配的条目</div>','hly-api-key-group','scrollHeight','请先选择一个\x20.txt\x20文件','当前所有操作都将指向这个锁定的宝库：','saveSettings','神力连接通畅！','hly-kb-list-global','未能获取到任何模型。','name','已选择\x200\x20/\x20','\x20个知识库吗？此操作无法恢复！','请先选择书库','预览失败:\x20','224053mJtRlP','all','remove','无法获取总数:\x20','hly-hist-entry-multiselect-options',',\x20失败:\x20','hly-rerank-notify','fa-circle-info','\x20(ID:\x20','\x20个知识库均已成功移动。','getLoresForWorldbook','用户尝试录入空文本。','lorebook','Google\x20API\x20Key:','previewHLYCondensation','hly-current-character-name','getCollectionId','chat','手动录入','圣旨已达','1613649zwtjIE','hly-rerank-top-n','正在清空宝库...','<option>正在获取...</option>','[自动保存]\x20设置项\x20\x27','条)</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22hly-kb-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','matchThreshold','[翰林院-枢纽]\x20获取模型列表失败:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22hly-kb-name-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20class=\x22hly-kb-item-checkbox\x22\x20data-kb-id=\x22','hanlinyuan-ingest-novel-file-name','[翰林院-枢纽]\x20更新忆识数量失败:','\x20个知识库的状态。','globalToLocal','success','hly-unified-template-notes','\x20(Key:\x20','文书已成功录入宝库，新增\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22hly-multiselect-option\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20id=\x22hly-hist-select-all-entries\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>全选/全不选</strong>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</label>','depth','hly-entry-search','hly-historiography-results','.hly-log-placeholder','dataset','start','未选择文件','根据标签提取或内容排除条件，未找到任何有效内容。','finalMessages','正在处理您提交的文书...','hly-overlap-size','神力连接失败:\x20','切换知识库\x20','input[name=\x22hly-unified-injection-position\x22]:checked','\x20个知识库\x20(范围:\x20','正在读取文件...','hly-kb-list-global-placeholder','<option>获取失败</option>','成功获取\x20','会话已锁定到:\x20','删除局部知识库\x20','hly-session-lock-btn','log-success','local','{{lorebook_text}}','notify','finalText','正在删除\x20','custom','text','\x20的状态已切换','getAvailableWorldbooks','preventDefault','fetchEmbeddingModels','label','hanlinyuan-ingest-novel-controls','<i\x20class=\x22fa-solid\x20','fas\x20fa-lock','批量编纂任务已完成，但有部分错误。','hly-include-ai','keys','\x20操作成功。','\x0a忆识总数:\x20','hly-kb-bulk-actions-','未知错误','floor','condensationHistory','key','.template','例如\x20http://127.0.0.1:8000/v1','开始对《','advanced','warning','\x20移动到\x20','输入兼容OpenAI的embeddings端点','\x20楼到\x20','ingestTextToHanlinyuan','<p\x20class=\x22hly-notes\x20log-error\x22><i>加载失败:\x20','radio','手动录入成功，新增\x20','您确定要将知识库【','total','{{novel_text}}','hly-tag-extraction-toggle','getCharacterName','.hly-kb-move-btn','forEach','获取模型失败:\x20','局部知识库批量删除完成。成功:\x20','insertAdjacentHTML','<div\x20class=\x22hly-preview-container-v2\x22>','点击以解锁，让翰林院跟随当前角色','》获取条目列表...','testApiConnection','info','[翰林院-枢纽]\x20预览过程发生错误:','type','condensation','\x20楼。</i></p>','input','知识库【','成功录入\x20','开始批量删除\x20','count','block','split','源区域（','任务已中止。','retrieval','\x20个局部知识库...','integer','layerStart','hly-kb-move-all-to-global','hly-worldbook-search','会话已解锁。','本地代理地址:','getMessagesForCondensation','[data-setting-key=\x22rerank.priorityRetrieval.sources.','fa-times-circle','确认并更新预览','tagExtractionEnabled','true','点击以锁定，让翰林院固定操作当前角色的宝库','您确定要将选中的\x20','active','hly-api-endpoint','N/A','ingestHLYManualText','getLocalKnowledgeBases','google_direct','检测到预览后待处理的消息对象，开始精确凝识...','hly-local-kb-char-name','global','文书录入失败:\x20','加载失败','kbId','resetHLYSettings','allWorldbooks','hly-kb-bulk-actions-local','开始将\x20','textContent','根据当前勾选条件，未找到符合的消息可供预览。','executeCompilation','log-info','hly-query-message-count','删除知识库\x20','toggleKnowledgeBase','正在处理您确认后的文书...','findIndex','#hly-add-rule-btn','updateHLYMemoryCount','-tab','click','准备对《','error','\x20个知识库的启用状态吗？','[断点续传]\x20用户选择继续任务\x20',']\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</summary>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22hly-preview-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20class=\x22hly-preview-textarea\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20data-floor=\x22','知识库\x20','预览并编辑凝识内容','录入内容不能为空。','hly-kb-select-all-local','hly-priority-retrieval-enabled','hly-hist-select-all-entries','hly-hist-select-library','parse','moveKnowledgeBase','[翰林院-枢纽]\x20获取Rerank模型列表失败:','div','翰林院设定已重置为初始状态。','%。是否从上次中断之处继续？','正在加载条目...','.enabled\x22]','map','编纂失败:\x20','hly-log-entry\x20','\x20个知识库。','自定义路径:','stringify','<p\x20class=\x22hly-record-hint\x22><i>上次已从第\x20','\x20楼已成功凝识，新增\x20','\x20个条目','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22hly-multiselect-option\x22\x20title=\x22','getSettings','title','hly-kb-delete-local-btn','严重错误','成功加载\x20','hly-batch-size','您确定要永久删除知识库【','批量移动过程中发生错误:\x20','hly-tag-input','#hly-rules-list','template','<p\x20class=\x22hly-record-hint\x22>可在此预览凝识结果。</p>','[翰林院-枢纽]\x20凝识过程发生错误:','addEventListener','圣谕不明','\x20个条目。','</i></p>','beforeend','<option\x20value=\x22\x22>未找到匹配的书库</option>','\x0a所用模型:\x20','url','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>','hly-chunk-size','hly-injection-source-selector','children','appendChild','[翰林院-枢纽]\x20查询宝库状态失败:','processedChunks','会话已锁定','成功移动了\x20','boolean','includes','settingKey','depth_role','）没有任何知识库可供移动。','.count\x22]','hanlinyuan-ingest-abort','length','content','totalChunks','amily2_open_rag_palace','[实时刷新]\x20批次完成，忆识总数已更新。','凝识失败:\x20','toLocaleTimeString','getLockedSessionInfo','内容排除规则已保存。','className','getElementById','removeKnowledgeBase','join','display','您确定要将\x20','hly-layer-start','span','切换状态失败:\x20','condensation.exclusionRules','fas\x20fa-lock-open','正在获取可用书库列表...','批量移动失败:\x20','hly-embedding-model','classList','contains','》中的\x20','filter','[翰林院-枢纽]\x20手动录入过程发生错误:','未能获取到任何Rerank模型。','hly-match-threshold','input[name=\x22','flex','hly-kb-list-local','toFixed','maxResults','warn','testHLYApi','overlap','innerHTML','option','{{text}}','批量编纂任务已开始...','batchSize','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','请至少选择一个知识库进行操作。','closest','hly-delete-rule-btn','hanlinyuan-ingest-progress-bar','add','移动失败:\x20','purgeHLYStorage','\x20个书库。','已选择\x20','】吗？','options','】已删除。','AbortError','preview-item-','user','.hly-exclusion-rule-row','initialize','699435Ehkkvp','placeholder','hly-retrieval-notify','kbScope','开始获取Rerank模型列表...','position','，重新开始。','apiEndpoint','model','.hly-preview-delete-btn-v2','move','none','indeterminate','未找到符合条件的消息可供凝识。','selectedIndex','4ZMLpHd','data','fetchHLYRerankModels','加载书库列表失败:\x20','\x20个知识库从\x20','_searchHandler','聊天记录从第\x20','mes','messageTypes','float','send_date','superSortEnabled','开始获取模型列表...','\x20操作...','end',',\x20向量:\x20','customApiUrl','\x20条有效条目），请点击“开始凝识”进入自动向量化流程。','\x20个模型。','[翰林院-枢纽]\x20加载《','priorityRetrieval','scripts/extensions/third-party/ST-Amily2-Chat-Optimisation/HanLin.md','entries','查询宝库状态失败:\x20','value','string','hly-modal-container','action','未找到匹配的条目','<option>未找到模型</option>','请先选择一个书库并至少选择一个要编纂的条目。','trim','toggle','hly-unified-injection-role','push','isSessionLocked','hly-exclusion-rules-container','锁定会话','[翰林院-枢纽]\x20渲染知识库列表失败:','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22hly-kb-name\x22\x20title=\x22ID:\x20','24zKtZNY','hanlinyuan-ingest-status','.hly-tab-pane','hly-tag-input-container','大功告成','from','enabled','hly-kb-list-local-placeholder','files','\x20块继续录入。','\x0a--------------------\x0aAPI端点:\x20','.hly-kb-item-checkbox:checked','totalSuccess','\x20个知识库执行批量操作...','hly-super-sort-enabled'];_0x26e1=function(){return _0x2938be;};return _0x26e1();}(function(_0xbffd83,_0x1d8c13){const _0x133cdd=_0x46ab,_0xc32ff7=_0xbffd83();while(!![]){try{const _0x35e3c1=parseInt(_0x133cdd(0x1c9))/0x1*(-parseInt(_0x133cdd(0x303))/0x2)+-parseInt(_0x133cdd(0x1dd))/0x3+-parseInt(_0x133cdd(0x369))/0x4+parseInt(_0x133cdd(0x2f4))/0x5+-parseInt(_0x133cdd(0x32b))/0x6*(-parseInt(_0x133cdd(0x36b))/0x7)+-parseInt(_0x133cdd(0x391))/0x8+parseInt(_0x133cdd(0x353))/0x9;if(_0x35e3c1===_0x1d8c13)break;else _0xc32ff7['push'](_0xc32ff7['shift']());}catch(_0x2578e0){_0xc32ff7['push'](_0xc32ff7['shift']());}}}(_0x26e1,0x810ce));import{getContext}from'/scripts/extensions.js';import*as _0x3ea5ae from'../core/rag-processor.js';import*as _0x39aed7 from'../core/historiographer.js';import*as _0x4219f5 from'../core/utils/context-utils.js';import*as _0x2b18f0 from'../core/ingestion-manager.js';import{showContentModal,showHtmlModal}from'./page-window.js';import{extractBlocksByTags,applyExclusionRules}from'../core/utils/rag-tag-extractor.js';import{filterWorldbooks,filterWorldbookEntries,highlightSearchMatch,debounce}from'../core/rag-processor.js';_0x13c5aa(0x1b9);function setupGlobalEventHandlers(){const _0x3b8020=_0x13c5aa;window[_0x3b8020(0x34f)]=()=>saveSettingsFromUI(![]),window[_0x3b8020(0x263)]=resetSettingsToUI,window[_0x3b8020(0x2db)]=testApi,window['fetchHLYEmbeddingModels']=fetchHLYEmbeddingModels,window[_0x3b8020(0x305)]=fetchHLYRerankModels,window[_0x3b8020(0x271)]=updatePanelStatus,window[_0x3b8020(0x2e9)]=purgeStorage,window[_0x3b8020(0x1b2)]=startCondensation,window[_0x3b8020(0x1d7)]=previewCondensation,window[_0x3b8020(0x25a)]=ingestManualText,window[_0x3b8020(0x383)]=log,window['showHLYStats']=showStats,window[_0x3b8020(0x398)]=startHistoriography;}function updateAndSaveSetting(_0x2cdadc,_0x6fe0f6){const _0x5313ff=_0x13c5aa,_0x5ba6c3=_0x3ea5ae[_0x5313ff(0x292)]();if(!_0x5ba6c3)return;const _0x4154a2=_0x2cdadc[_0x5313ff(0x244)]('.');let _0x7d7092=_0x5ba6c3;for(let _0x467a1c=0x0;_0x467a1c<_0x4154a2[_0x5313ff(0x2b7)]-0x1;_0x467a1c++){_0x7d7092=_0x7d7092[_0x4154a2[_0x467a1c]]=_0x7d7092[_0x4154a2[_0x467a1c]]||{};}_0x7d7092[_0x4154a2[_0x4154a2[_0x5313ff(0x2b7)]-0x1]]=_0x6fe0f6,_0x3ea5ae[_0x5313ff(0x1c0)](),log(_0x5313ff(0x1e1)+_0x2cdadc+'\x27\x20已更新为:\x20'+JSON[_0x5313ff(0x28d)](_0x6fe0f6),'success');}function bindAutoSaveEvents(){const _0x1459b5=_0x13c5aa,_0x26a668=document['getElementById'](_0x1459b5(0x31d));if(!_0x26a668)return;_0x26a668['addEventListener'](_0x1459b5(0x380),_0x22a91e=>{const _0x4c99d2=_0x1459b5,_0x2a39c0=_0x22a91e[_0x4c99d2(0x350)],_0x4479a3=_0x2a39c0[_0x4c99d2(0x1f3)][_0x4c99d2(0x2b2)];if(!_0x4479a3)return;let _0x67941b;const _0x592331=_0x2a39c0['dataset'][_0x4c99d2(0x23b)]||'string';if(_0x2a39c0[_0x4c99d2(0x23b)]===_0x4c99d2(0x35e))_0x67941b=_0x2a39c0[_0x4c99d2(0x367)];else{if(_0x2a39c0[_0x4c99d2(0x23b)]===_0x4c99d2(0x229)){if(_0x2a39c0[_0x4c99d2(0x367)]){const _0x2ec78f=_0x26a668[_0x4c99d2(0x341)](_0x4c99d2(0x2d5)+_0x2a39c0[_0x4c99d2(0x1c4)]+'\x22]'),_0x41194b=Array[_0x4c99d2(0x330)](_0x2ec78f)['find'](_0x26a07a=>_0x26a07a['checked']);_0x67941b=_0x41194b[_0x4c99d2(0x31b)];}else return;}else _0x67941b=_0x2a39c0[_0x4c99d2(0x31b)];}switch(_0x592331){case _0x4c99d2(0x249):_0x67941b=parseInt(_0x67941b,0xa);break;case _0x4c99d2(0x30c):_0x67941b=parseFloat(_0x67941b);break;case _0x4c99d2(0x2b0):typeof _0x67941b!==_0x4c99d2(0x2b0)&&(_0x67941b=_0x67941b===_0x4c99d2(0x254));break;}if(_0x2a39c0[_0x4c99d2(0x23b)]==='radio'&&!_0x2a39c0[_0x4c99d2(0x367)])return;updateAndSaveSetting(_0x4479a3,_0x67941b);});}export function bindHanlinyuanEvents(){const _0x358c5e=_0x13c5aa,_0x3539fe=getContext();if(!_0x3539fe){console[_0x358c5e(0x275)](_0x358c5e(0x384));return;}setupGlobalEventHandlers(),bindPanelToggleEvents(),bindInternalUIEvents(),bindTutorialEvents(),bindAutoSaveEvents(),bindSessionLockEvent(),initializeUnifiedInjectionEditor();if(_0x3ea5ae[_0x358c5e(0x2f3)])_0x3ea5ae[_0x358c5e(0x2f3)]();else{console[_0x358c5e(0x275)]('[翰林院-枢纽]\x20核心法典未能提供初始化圣旨！');return;}loadSettingsToUI(),loadWorldbookList(),log('[翰林院-枢纽]\x20已成功连接各部，政令畅通。','info');const _0x1a40ff=document[_0x358c5e(0x2c1)]('hanlinyuan-ingest-novel-file-input'),_0x15d752=document[_0x358c5e(0x2c1)](_0x358c5e(0x1e6)),_0x492665=document[_0x358c5e(0x2c1)]('hanlinyuan-ingest-novel-start'),_0xd499b6=document['getElementById'](_0x358c5e(0x2b6)),_0x289f42=document[_0x358c5e(0x2c1)](_0x358c5e(0x1b8)),_0x1d4ca9=document[_0x358c5e(0x2c1)](_0x358c5e(0x2e6)),_0x114c01=document[_0x358c5e(0x2c1)](_0x358c5e(0x32c)),_0x5aefec=document[_0x358c5e(0x2c1)](_0x358c5e(0x212));let _0x1fc14c=null,_0x28e660=null;_0x1a40ff['addEventListener'](_0x358c5e(0x380),_0x379f9a=>{const _0x3e4424=_0x358c5e;_0x1fc14c=_0x379f9a[_0x3e4424(0x350)][_0x3e4424(0x333)][0x0],_0x1fc14c?(_0x15d752[_0x3e4424(0x267)]=_0x1fc14c['name'],_0x15d752[_0x3e4424(0x293)]=_0x1fc14c[_0x3e4424(0x1c4)]):_0x15d752['textContent']=_0x3e4424(0x1f5);}),_0x492665['addEventListener'](_0x358c5e(0x273),async()=>{const _0x5e9b4f=_0x358c5e;if(!_0x1fc14c){toastr[_0x5e9b4f(0x223)](_0x5e9b4f(0x1be));return;}let _0x5d9faa=0x0;const _0x2ba450=_0x2b18f0['generateJobId'](_0x1fc14c),_0x4523f7=_0x2b18f0['loadProgress'](_0x2ba450);if(_0x4523f7){const _0x55fd8a=(_0x4523f7['processedChunks']/_0x4523f7[_0x5e9b4f(0x2b9)]*0x64)[_0x5e9b4f(0x2d8)](0x1),_0x1d1797=confirm('启禀大人，发现此书上次录入已完成\x20'+_0x55fd8a+_0x5e9b4f(0x285));_0x1d1797?(_0x5d9faa=_0x4523f7[_0x5e9b4f(0x2ad)],toastr[_0x5e9b4f(0x239)]('遵命，将从第\x20'+(_0x5d9faa+0x1)+_0x5e9b4f(0x334),_0x5e9b4f(0x1dc)),log(_0x5e9b4f(0x277)+_0x2ba450+'，从第\x20'+_0x5d9faa+'\x20块开始。',_0x5e9b4f(0x239))):(_0x2b18f0[_0x5e9b4f(0x361)](_0x2ba450),toastr[_0x5e9b4f(0x239)]('遵命，将从头开始录入此书。',_0x5e9b4f(0x1dc)),log('[断点续传]\x20用户选择放弃旧任务\x20'+_0x2ba450+_0x5e9b4f(0x2fa),_0x5e9b4f(0x2da)));}_0x28e660=new AbortController();const _0x568d6b=_0x28e660[_0x5e9b4f(0x34b)];_0x5aefec[_0x5e9b4f(0x33c)][_0x5e9b4f(0x2c4)]=_0x5e9b4f(0x2ff),_0x289f42['style'][_0x5e9b4f(0x2c4)]=_0x5e9b4f(0x243),_0x114c01[_0x5e9b4f(0x267)]=_0x5e9b4f(0x1fe),_0x1d4ca9['value']=0x0;try{const _0x286f11=await _0x1fc14c[_0x5e9b4f(0x20c)](),_0x16e89e=_0x3b0214=>{const _0x1bd666=_0x5e9b4f;_0x114c01['textContent']='处理中:\x20'+_0x3b0214[_0x1bd666(0x374)]+'\x20('+_0x3b0214[_0x1bd666(0x36e)]+'/'+_0x3b0214['total']+')',_0x1d4ca9[_0x1bd666(0x31b)]=_0x3b0214[_0x1bd666(0x36e)]/_0x3b0214[_0x1bd666(0x22c)]*0x64;},_0x2252c4=()=>{const _0x1ab40e=_0x5e9b4f;updatePanelStatus(),log(_0x1ab40e(0x2bb),_0x1ab40e(0x239));},_0x2ab440=await _0x3ea5ae[_0x5e9b4f(0x227)](_0x286f11,_0x5e9b4f(0x364),{'sourceName':_0x1fc14c[_0x5e9b4f(0x1c4)]},_0x16e89e,_0x568d6b,log,_0x2252c4,_0x2ba450,_0x5d9faa);if(_0x2ab440[_0x5e9b4f(0x1ea)])toastr['success'](_0x5e9b4f(0x240)+_0x2ab440[_0x5e9b4f(0x242)]+_0x5e9b4f(0x34d)),_0x114c01[_0x5e9b4f(0x267)]=_0x5e9b4f(0x355)+_0x2ab440['count']+'\x20个知识块。',_0x1d4ca9[_0x5e9b4f(0x31b)]=0x64,updatePanelStatus();else throw new Error(_0x2ab440[_0x5e9b4f(0x275)]||_0x5e9b4f(0x21b));}catch(_0x2dfd88){_0x2dfd88[_0x5e9b4f(0x1c4)]===_0x5e9b4f(0x2ef)?(toastr[_0x5e9b4f(0x239)]('任务已由用户中止。进度已保存，可随时继续。'),_0x114c01['textContent']=_0x5e9b4f(0x246)):(toastr['error']('录入失败:\x20'+_0x2dfd88[_0x5e9b4f(0x374)]+_0x5e9b4f(0x385)),_0x114c01[_0x5e9b4f(0x267)]=_0x5e9b4f(0x1af)+_0x2dfd88['message']);}finally{setTimeout(()=>{const _0x1d4b4a=_0x5e9b4f;_0x5aefec[_0x1d4b4a(0x33c)][_0x1d4b4a(0x2c4)]=_0x1d4b4a(0x2d6),_0x289f42[_0x1d4b4a(0x33c)][_0x1d4b4a(0x2c4)]='none',_0x1a40ff['value']='',_0x1fc14c=null,_0x15d752[_0x1d4b4a(0x267)]=_0x1d4b4a(0x1f5);},0xbb8);}}),_0xd499b6['addEventListener'](_0x358c5e(0x273),()=>{_0x28e660&&_0x28e660['abort']();});}function bindSessionLockEvent(){const _0xf9445a=_0x13c5aa,_0x5a4669=document['getElementById'](_0xf9445a(0x204));if(!_0x5a4669)return;_0x5a4669[_0xf9445a(0x29f)](_0xf9445a(0x273),async()=>{const _0x4d7e8c=_0xf9445a,_0x133598=await _0x3ea5ae[_0x4d7e8c(0x395)]();updateSessionLockUI(_0x133598);if(_0x133598){const _0x3ef4d3=_0x3ea5ae[_0x4d7e8c(0x2be)]();_0x3ef4d3&&(toastr[_0x4d7e8c(0x1ea)](_0x4d7e8c(0x202)+_0x3ef4d3['id'],_0x4d7e8c(0x35d)),log('会话已锁定到宝库:\x20'+_0x3ef4d3['id'],_0x4d7e8c(0x1ea)));}else toastr[_0x4d7e8c(0x239)](_0x4d7e8c(0x372),'诏曰'),log(_0x4d7e8c(0x24d),_0x4d7e8c(0x239));updatePanelStatus();}),updateSessionLockUI(_0x3ea5ae[_0xf9445a(0x326)]());}function updateSessionLockUI(_0x194791){const _0x500a47=_0x13c5aa,_0x8e5f90=document[_0x500a47(0x2c1)](_0x500a47(0x204));if(!_0x8e5f90)return;const _0x50a486=_0x8e5f90['querySelector']('i'),_0x4a575d=_0x8e5f90['querySelector']('span');_0x194791?(_0x8e5f90[_0x500a47(0x2ce)][_0x500a47(0x2e7)](_0x500a47(0x257)),_0x50a486[_0x500a47(0x2c0)]=_0x500a47(0x214),_0x4a575d[_0x500a47(0x267)]=_0x500a47(0x37d),_0x8e5f90['title']=_0x500a47(0x236)):(_0x8e5f90[_0x500a47(0x2ce)][_0x500a47(0x1cb)](_0x500a47(0x257)),_0x50a486['className']=_0x500a47(0x2ca),_0x4a575d[_0x500a47(0x267)]=_0x500a47(0x328),_0x8e5f90[_0x500a47(0x293)]=_0x500a47(0x255));}function bindPanelToggleEvents(){const _0x599651=_0x13c5aa,_0x3b3149=document['getElementById'](_0x599651(0x2ba));if(_0x3b3149){}}function bindTutorialEvents(){const _0x2e467f=_0x13c5aa,_0x3c1052=document[_0x2e467f(0x2c1)]('amily2_open_hanlin_tutorial');_0x3c1052&&_0x3c1052[_0x2e467f(0x29f)](_0x2e467f(0x273),()=>{const _0x58aef2=_0x2e467f;showContentModal(_0x58aef2(0x375),_0x58aef2(0x318));});}function bindInternalUIEvents(){const _0x12a9cd=_0x13c5aa,_0x18755e=document['querySelectorAll']('.hly-nav-item');_0x18755e[_0x12a9cd(0x231)](_0x52d4ef=>{const _0x34fced=_0x12a9cd;_0x52d4ef['addEventListener'](_0x34fced(0x273),()=>{const _0x519e07=_0x34fced,_0x1d0d3b=_0x52d4ef['dataset']['tab'],_0x58e750=_0x519e07(0x1ad)+_0x1d0d3b+_0x519e07(0x272);document[_0x519e07(0x341)](_0x519e07(0x32d))[_0x519e07(0x231)](_0x526b7c=>{const _0x461e36=_0x519e07;_0x526b7c[_0x461e36(0x2ce)][_0x461e36(0x323)]('active',_0x526b7c['id']===_0x58e750);}),_0x18755e['forEach'](_0x2ee1a4=>_0x2ee1a4[_0x519e07(0x2ce)]['toggle'](_0x519e07(0x257),_0x2ee1a4===_0x52d4ef));});});const _0x42477f=document[_0x12a9cd(0x2c1)]('hly-api-endpoint');_0x42477f&&_0x42477f[_0x12a9cd(0x29f)]('change',handleApiModeChange);const _0x293171=document[_0x12a9cd(0x2c1)]('hly-tag-extraction-toggle'),_0x17079d=document[_0x12a9cd(0x2c1)](_0x12a9cd(0x32e));_0x293171&&_0x17079d&&_0x293171[_0x12a9cd(0x29f)](_0x12a9cd(0x380),()=>{const _0x2809e2=_0x12a9cd;_0x17079d[_0x2809e2(0x33c)]['display']=_0x293171['checked']?_0x2809e2(0x243):'none';});const _0x176373=document[_0x12a9cd(0x2c1)]('hly-hist-select-library');_0x176373&&_0x176373['addEventListener'](_0x12a9cd(0x380),handleWorldbookSelectionChange);const _0x4de2b0=document['getElementById'](_0x12a9cd(0x1b0));_0x4de2b0&&_0x4de2b0['addEventListener'](_0x12a9cd(0x273),showExclusionRulesModal);const _0x2cce62=document[_0x12a9cd(0x2c1)](_0x12a9cd(0x396)),_0x281e45=document[_0x12a9cd(0x2c1)](_0x12a9cd(0x1cd));_0x2cce62&&_0x281e45&&(_0x2cce62['addEventListener'](_0x12a9cd(0x273),_0x669894=>{const _0x39388a=_0x12a9cd;_0x669894['stopPropagation']();const _0xfa8481=_0x281e45[_0x39388a(0x33c)][_0x39388a(0x2c4)]===_0x39388a(0x243);_0x281e45['style'][_0x39388a(0x2c4)]=_0xfa8481?_0x39388a(0x2ff):'block';}),_0x281e45[_0x12a9cd(0x29f)](_0x12a9cd(0x380),_0xda9961=>{const _0x4f9b82=_0x12a9cd,_0x1d0621=_0xda9961[_0x4f9b82(0x350)];if(_0x1d0621['type']!==_0x4f9b82(0x35e))return;const _0x5f2e12=_0x281e45[_0x4f9b82(0x341)](_0x4f9b82(0x354)),_0x4f9b1e=document[_0x4f9b82(0x2c1)]('hly-hist-select-all-entries');if(_0x1d0621['id']===_0x4f9b82(0x27e))_0x5f2e12[_0x4f9b82(0x231)](_0x562ba5=>_0x562ba5['checked']=_0x1d0621[_0x4f9b82(0x367)]);else{const _0x3771a7=Array[_0x4f9b82(0x330)](_0x5f2e12)[_0x4f9b82(0x37f)](_0x8575c5=>_0x8575c5[_0x4f9b82(0x367)]);_0x4f9b1e[_0x4f9b82(0x367)]=_0x3771a7;}const _0x5bb7b2=_0x281e45['querySelectorAll'](_0x4f9b82(0x38e))[_0x4f9b82(0x2b7)],_0x2de389=_0x5f2e12[_0x4f9b82(0x2b7)];_0x2cce62[_0x4f9b82(0x1a8)](_0x4f9b82(0x2c7))[_0x4f9b82(0x267)]=_0x4f9b82(0x2eb)+_0x5bb7b2+'\x20/\x20'+_0x2de389+_0x4f9b82(0x290);}),document[_0x12a9cd(0x29f)](_0x12a9cd(0x273),_0x172814=>{const _0xf26208=_0x12a9cd;!_0x2cce62[_0xf26208(0x2cf)](_0x172814[_0xf26208(0x350)])&&!_0x281e45['contains'](_0x172814[_0xf26208(0x350)])&&(_0x281e45[_0xf26208(0x33c)][_0xf26208(0x2c4)]=_0xf26208(0x2ff));}));const _0x3927d9=document[_0x12a9cd(0x2c1)](_0x12a9cd(0x294));_0x3927d9&&_0x3927d9['addEventListener'](_0x12a9cd(0x273),deleteAllLocalKnowledgeBases);const _0x3f9b5b=document[_0x12a9cd(0x2c1)]('hly-kb-move-all-to-local');_0x3f9b5b&&_0x3f9b5b[_0x12a9cd(0x29f)](_0x12a9cd(0x273),()=>moveAllKnowledgeBases(_0x12a9cd(0x1e9)));const _0x195e9b=document[_0x12a9cd(0x2c1)](_0x12a9cd(0x24b));_0x195e9b&&_0x195e9b[_0x12a9cd(0x29f)]('click',()=>moveAllKnowledgeBases(_0x12a9cd(0x35b)));const _0x19cb73=[_0x12a9cd(0x2d7),_0x12a9cd(0x1c2)];_0x19cb73[_0x12a9cd(0x231)](_0x9004ec=>{const _0x157250=_0x12a9cd,_0x3e6170=document[_0x157250(0x2c1)](_0x9004ec);_0x3e6170&&(_0x3e6170[_0x157250(0x29f)]('click',handleKbAction),_0x3e6170[_0x157250(0x29f)](_0x157250(0x380),handleKbAction));}),document[_0x12a9cd(0x2c1)]('hly-kb-select-all-global')[_0x12a9cd(0x29f)](_0x12a9cd(0x380),_0x7c96a2=>handleSelectAll(_0x7c96a2,'global')),document[_0x12a9cd(0x2c1)](_0x12a9cd(0x27c))[_0x12a9cd(0x29f)](_0x12a9cd(0x380),_0x76f3fa=>handleSelectAll(_0x76f3fa,_0x12a9cd(0x206))),document[_0x12a9cd(0x2c1)]('hly-kb-bulk-actions-global')['addEventListener'](_0x12a9cd(0x273),_0x4116a0=>handleBulkAction(_0x4116a0,'global')),document[_0x12a9cd(0x2c1)](_0x12a9cd(0x265))[_0x12a9cd(0x29f)]('click',_0x23201f=>handleBulkAction(_0x23201f,'local'));}function initializeUnifiedInjectionEditor(){const _0x52e435=_0x13c5aa,_0x5a544c=document[_0x52e435(0x2c1)](_0x52e435(0x2a9)),_0xd0d94b=document[_0x52e435(0x2c1)]('hly-unified-template-editor'),_0x308989=document[_0x52e435(0x2c1)](_0x52e435(0x1eb)),_0x2f050e=document['querySelectorAll']('input[name=\x22hly-unified-injection-position\x22]'),_0x4c0fc9=document[_0x52e435(0x2c1)](_0x52e435(0x360)),_0x3c0ad7=document[_0x52e435(0x2c1)](_0x52e435(0x324));if(!_0x5a544c)return;const _0x436300={'novel':_0x52e435(0x22d),'chat':_0x52e435(0x34a),'lorebook':_0x52e435(0x207),'manual':'{{manual_text}}'};function _0x39e59f(){const _0x25ac8f=_0x52e435,_0x5e1389=_0x5a544c[_0x25ac8f(0x31b)],_0x4f268e=_0x3ea5ae[_0x25ac8f(0x292)](),_0x138003=_0x4f268e[_0x25ac8f(0x1a2)+_0x5e1389]||{};_0xd0d94b[_0x25ac8f(0x31b)]=_0x138003[_0x25ac8f(0x29c)]||'',_0x308989[_0x25ac8f(0x267)]='以\x20'+(_0x436300[_0x5e1389]||_0x25ac8f(0x2df))+'\x20为占位符。';const _0xca54ed=_0x138003[_0x25ac8f(0x2f9)]!==undefined?String(_0x138003[_0x25ac8f(0x2f9)]):'2';_0x2f050e['forEach'](_0xaffbbe=>_0xaffbbe[_0x25ac8f(0x367)]=_0xaffbbe[_0x25ac8f(0x31b)]===_0xca54ed),_0x4c0fc9[_0x25ac8f(0x31b)]=_0x138003[_0x25ac8f(0x1ef)]||0x0,_0x3c0ad7[_0x25ac8f(0x31b)]=_0x138003[_0x25ac8f(0x2b3)]!==undefined?String(_0x138003[_0x25ac8f(0x2b3)]):'0';const _0x22f8ce=_0xca54ed==='1';_0x4c0fc9[_0x25ac8f(0x39b)]=!_0x22f8ce,_0x3c0ad7[_0x25ac8f(0x39b)]=!_0x22f8ce;}function _0x711689(){const _0x123e14=_0x52e435,_0x55ab01=_0x5a544c['value'];updateAndSaveSetting(_0x123e14(0x1a2)+_0x55ab01+_0x123e14(0x21f),_0xd0d94b[_0x123e14(0x31b)]);const _0xe2ab84=document[_0x123e14(0x1a8)](_0x123e14(0x1fc));_0xe2ab84&&updateAndSaveSetting(_0x123e14(0x1a2)+_0x55ab01+'.position',parseInt(_0xe2ab84['value'],0xa)),updateAndSaveSetting(_0x123e14(0x1a2)+_0x55ab01+'.depth',parseInt(_0x4c0fc9['value'],0xa)),updateAndSaveSetting(_0x123e14(0x1a2)+_0x55ab01+'.depth_role',parseInt(_0x3c0ad7['value'],0xa));}_0x5a544c[_0x52e435(0x29f)](_0x52e435(0x380),_0x39e59f);const _0x502f5a=debounce(_0x711689,0x12c);_0xd0d94b['addEventListener'](_0x52e435(0x23e),_0x502f5a),_0x4c0fc9[_0x52e435(0x29f)](_0x52e435(0x380),_0x711689),_0x3c0ad7[_0x52e435(0x29f)](_0x52e435(0x380),_0x711689),_0x2f050e[_0x52e435(0x231)](_0x5efd7f=>_0x5efd7f['addEventListener']('change',()=>{const _0x5ed7bf=_0x52e435;_0x711689();const _0x8dcdd=_0x5efd7f[_0x5ed7bf(0x31b)]==='1'&&_0x5efd7f[_0x5ed7bf(0x367)];_0x4c0fc9[_0x5ed7bf(0x39b)]=!_0x8dcdd,_0x3c0ad7[_0x5ed7bf(0x39b)]=!_0x8dcdd;})),_0x39e59f();}function handleApiModeChange(){const _0x593852=_0x13c5aa,_0x31ae35=document[_0x593852(0x2c1)](_0x593852(0x258))[_0x593852(0x31b)],_0x5ba98e=document['getElementById']('hly-custom-endpoint-docket'),_0x4ab27c=document[_0x593852(0x2c1)](_0x593852(0x1bc)),_0x3763b6=document[_0x593852(0x2c1)](_0x593852(0x2cd)),_0x1656c5=_0x3763b6[_0x593852(0x373)];if(!_0x5ba98e||!_0x4ab27c)return;_0x5ba98e[_0x593852(0x33c)][_0x593852(0x2c4)]=_0x593852(0x243),_0x4ab27c[_0x593852(0x33c)][_0x593852(0x2c4)]=_0x593852(0x243);switch(_0x31ae35){case _0x593852(0x25c):_0x5ba98e[_0x593852(0x33c)][_0x593852(0x2c4)]=_0x593852(0x2ff),_0x4ab27c[_0x593852(0x1a8)](_0x593852(0x211))['textContent']=_0x593852(0x1d6),_0x4ab27c[_0x593852(0x1a8)](_0x593852(0x23e))[_0x593852(0x2f5)]=_0x593852(0x394);break;case _0x593852(0x37a):_0x5ba98e[_0x593852(0x1a8)]('label')[_0x593852(0x267)]=_0x593852(0x24e),_0x5ba98e[_0x593852(0x1a8)](_0x593852(0x23e))['placeholder']=_0x593852(0x220),_0x4ab27c[_0x593852(0x33c)][_0x593852(0x2c4)]=_0x593852(0x2ff);break;case _0x593852(0x20b):default:_0x5ba98e['querySelector'](_0x593852(0x211))[_0x593852(0x267)]=_0x593852(0x28c),_0x5ba98e[_0x593852(0x1a8)](_0x593852(0x23e))[_0x593852(0x2f5)]=_0x593852(0x225),_0x4ab27c[_0x593852(0x1a8)](_0x593852(0x211))[_0x593852(0x267)]=_0x593852(0x344);break;}}function loadSettingsToUI(){const _0x152653=_0x13c5aa,_0x2147ae=_0x3ea5ae['getSettings']();if(!_0x2147ae)return;document['getElementById'](_0x152653(0x377))[_0x152653(0x367)]=_0x2147ae[_0x152653(0x247)][_0x152653(0x331)],document[_0x152653(0x2c1)](_0x152653(0x258))[_0x152653(0x31b)]=_0x2147ae[_0x152653(0x247)][_0x152653(0x2fb)],document[_0x152653(0x2c1)]('hly-custom-api-url')[_0x152653(0x31b)]=_0x2147ae[_0x152653(0x247)][_0x152653(0x313)],document[_0x152653(0x2c1)](_0x152653(0x38c))[_0x152653(0x31b)]=_0x2147ae[_0x152653(0x247)][_0x152653(0x33f)];const _0x17704e=document[_0x152653(0x2c1)]('hly-embedding-model');if(_0x17704e['options'][_0x152653(0x2b7)]===0x0){const _0x191c41=_0x2147ae[_0x152653(0x247)]['embeddingModel'],_0x51db66=new Option(_0x191c41,_0x191c41,!![],!![]);_0x17704e['add'](_0x51db66);}_0x17704e[_0x152653(0x31b)]=_0x2147ae[_0x152653(0x247)][_0x152653(0x386)],document[_0x152653(0x2c1)](_0x152653(0x2f6))['checked']=_0x2147ae[_0x152653(0x247)][_0x152653(0x208)],document[_0x152653(0x2c1)](_0x152653(0x2a8))[_0x152653(0x31b)]=_0x2147ae[_0x152653(0x222)][_0x152653(0x348)],document['getElementById'](_0x152653(0x1f9))[_0x152653(0x31b)]=_0x2147ae[_0x152653(0x222)][_0x152653(0x2dc)],document[_0x152653(0x2c1)](_0x152653(0x2d4))[_0x152653(0x31b)]=_0x2147ae[_0x152653(0x222)][_0x152653(0x1e3)],document[_0x152653(0x2c1)](_0x152653(0x26b))[_0x152653(0x31b)]=_0x2147ae[_0x152653(0x222)]['queryMessageCount'],document[_0x152653(0x2c1)]('hly-max-results')[_0x152653(0x31b)]=_0x2147ae[_0x152653(0x222)][_0x152653(0x2d9)],document[_0x152653(0x2c1)](_0x152653(0x297))[_0x152653(0x31b)]=_0x2147ae[_0x152653(0x247)][_0x152653(0x2e1)],handleApiModeChange(),document['getElementById']('hly-condensation-enabled')[_0x152653(0x367)]=_0x2147ae[_0x152653(0x23c)][_0x152653(0x331)],document[_0x152653(0x2c1)](_0x152653(0x2c6))[_0x152653(0x31b)]=_0x2147ae[_0x152653(0x23c)][_0x152653(0x24a)],document[_0x152653(0x2c1)]('hly-layer-end')['value']=_0x2147ae[_0x152653(0x23c)]['layerEnd'],document[_0x152653(0x2c1)](_0x152653(0x33b))['checked']=_0x2147ae[_0x152653(0x23c)][_0x152653(0x30b)][_0x152653(0x2f1)],document['getElementById']('hly-include-ai')[_0x152653(0x367)]=_0x2147ae['condensation'][_0x152653(0x30b)]['ai'];const _0x17bce8=document[_0x152653(0x2c1)](_0x152653(0x22e)),_0x2e0b57=document[_0x152653(0x2c1)](_0x152653(0x29a)),_0x41f91d=document[_0x152653(0x2c1)](_0x152653(0x32e));_0x17bce8[_0x152653(0x367)]=_0x2147ae[_0x152653(0x23c)][_0x152653(0x253)],_0x2e0b57[_0x152653(0x31b)]=_0x2147ae['condensation'][_0x152653(0x357)],_0x41f91d[_0x152653(0x33c)][_0x152653(0x2c4)]=_0x17bce8[_0x152653(0x367)]?_0x152653(0x243):_0x152653(0x2ff),document[_0x152653(0x2c1)]('hly-rerank-enabled')['checked']=_0x2147ae[_0x152653(0x365)]['enabled'],document[_0x152653(0x2c1)](_0x152653(0x1aa))[_0x152653(0x31b)]=_0x2147ae[_0x152653(0x365)][_0x152653(0x2a6)],document[_0x152653(0x2c1)]('hly-rerank-api-key')['value']=_0x2147ae[_0x152653(0x365)]['apiKey'];const _0x300de8=document[_0x152653(0x2c1)](_0x152653(0x370));if(_0x300de8[_0x152653(0x2ed)][_0x152653(0x2b7)]===0x0){const _0x226cf5=_0x2147ae[_0x152653(0x365)][_0x152653(0x2fc)];if(_0x226cf5){const _0x29d2c4=new Option(_0x226cf5,_0x226cf5,!![],!![]);_0x300de8[_0x152653(0x2e7)](_0x29d2c4);}}_0x300de8[_0x152653(0x31b)]=_0x2147ae[_0x152653(0x365)][_0x152653(0x2fc)],document[_0x152653(0x2c1)](_0x152653(0x1de))['value']=_0x2147ae[_0x152653(0x365)]['top_n'],document[_0x152653(0x2c1)]('hly-rerank-hybrid-alpha')[_0x152653(0x31b)]=_0x2147ae['rerank']['hybrid_alpha'],document[_0x152653(0x2c1)](_0x152653(0x1cf))[_0x152653(0x367)]=_0x2147ae[_0x152653(0x365)][_0x152653(0x208)],document[_0x152653(0x2c1)](_0x152653(0x339))[_0x152653(0x367)]=_0x2147ae[_0x152653(0x365)][_0x152653(0x30e)];const _0x5c257c=_0x2147ae[_0x152653(0x365)][_0x152653(0x317)];if(_0x5c257c){document[_0x152653(0x2c1)](_0x152653(0x27d))[_0x152653(0x367)]=_0x5c257c['enabled'];const _0xe0394a=[_0x152653(0x364),'chat_history',_0x152653(0x1d5),'manual'];_0xe0394a[_0x152653(0x231)](_0x3b4860=>{const _0x51681c=_0x152653,_0x1a3484=_0x5c257c[_0x51681c(0x349)][_0x3b4860];if(_0x1a3484){const _0x34997e=document[_0x51681c(0x1a8)](_0x51681c(0x250)+_0x3b4860+_0x51681c(0x287)),_0x485759=document[_0x51681c(0x1a8)](_0x51681c(0x250)+_0x3b4860+_0x51681c(0x2b5));if(_0x34997e)_0x34997e['checked']=_0x1a3484[_0x51681c(0x331)];if(_0x485759)_0x485759[_0x51681c(0x31b)]=_0x1a3484['count'];}});}}function saveSettingsFromUI(_0x2cfe39=!![]){const _0x48d19c=_0x13c5aa,_0x3d42a4=document[_0x48d19c(0x2c1)](_0x48d19c(0x31d));if(!_0x3d42a4)return;const _0x262c8c=_0x3d42a4[_0x48d19c(0x341)](_0x48d19c(0x38a));_0x262c8c['forEach'](_0x1e55e3=>{const _0x2e104f=_0x48d19c,_0x5976ce=_0x1e55e3[_0x2e104f(0x1f3)]['settingKey'];if(!_0x5976ce)return;let _0x53e4ab;const _0x5a3641=_0x1e55e3['dataset'][_0x2e104f(0x23b)]||_0x2e104f(0x31c);if(_0x1e55e3[_0x2e104f(0x23b)]===_0x2e104f(0x35e))_0x53e4ab=_0x1e55e3[_0x2e104f(0x367)];else{if(_0x1e55e3[_0x2e104f(0x23b)]===_0x2e104f(0x229)){if(!_0x1e55e3[_0x2e104f(0x367)])return;_0x53e4ab=_0x1e55e3[_0x2e104f(0x31b)];}else _0x53e4ab=_0x1e55e3[_0x2e104f(0x31b)];}switch(_0x5a3641){case'integer':_0x53e4ab=parseInt(_0x53e4ab,0xa);break;case _0x2e104f(0x30c):_0x53e4ab=parseFloat(_0x53e4ab);break;case _0x2e104f(0x2b0):if(typeof _0x53e4ab!==_0x2e104f(0x2b0))_0x53e4ab=_0x53e4ab===_0x2e104f(0x254);break;}const _0x4d3cc7=_0x3ea5ae[_0x2e104f(0x292)](),_0xafae24=_0x5976ce[_0x2e104f(0x244)]('.');let _0x1c0d3b=_0x4d3cc7;for(let _0x5234b3=0x0;_0x5234b3<_0xafae24[_0x2e104f(0x2b7)]-0x1;_0x5234b3++){_0x1c0d3b=_0x1c0d3b[_0xafae24[_0x5234b3]]=_0x1c0d3b[_0xafae24[_0x5234b3]]||{};}_0x1c0d3b[_0xafae24[_0xafae24['length']-0x1]]=_0x53e4ab;}),_0x3ea5ae['saveSettings'](),!_0x2cfe39&&(log(_0x48d19c(0x35c),_0x48d19c(0x1ea)),toastr[_0x48d19c(0x1ea)](_0x48d19c(0x1b5),'圣旨已达'));}function resetSettingsToUI(){const _0x461f55=_0x13c5aa;confirm('您确定要将所有设定恢复为出厂默认值吗？')&&(_0x3ea5ae['resetSettings'](),loadSettingsToUI(),toastr[_0x461f55(0x239)](_0x461f55(0x284),'诏曰'));}async function updatePanelStatus(){const _0x2526c4=_0x13c5aa,_0x1b6605=_0x3ea5ae[_0x2526c4(0x326)](),_0x4285ac=document['getElementById'](_0x2526c4(0x1d8)),_0x559f64=document['getElementById'](_0x2526c4(0x1b7));if(_0x1b6605){const _0x3d3f8c=_0x3ea5ae['getLockedSessionInfo']();_0x3d3f8c&&(_0x4285ac[_0x2526c4(0x267)]=_0x2526c4(0x2ae),_0x559f64[_0x2526c4(0x267)]=_0x3d3f8c['id'],_0x559f64[_0x2526c4(0x293)]=_0x2526c4(0x1bf)+_0x3d3f8c['id'],_0x4285ac[_0x2526c4(0x2ce)][_0x2526c4(0x2e7)](_0x2526c4(0x34e)),_0x559f64['classList']['add'](_0x2526c4(0x34e)));}else _0x4285ac[_0x2526c4(0x267)]=_0x4219f5[_0x2526c4(0x22f)](),_0x559f64[_0x2526c4(0x267)]=_0x4219f5[_0x2526c4(0x36d)]()||'无',_0x559f64[_0x2526c4(0x293)]='',_0x4285ac[_0x2526c4(0x2ce)][_0x2526c4(0x1cb)](_0x2526c4(0x34e)),_0x559f64[_0x2526c4(0x2ce)][_0x2526c4(0x1cb)](_0x2526c4(0x34e));const _0xf7fe30=document[_0x2526c4(0x2c1)]('hly-current-vector-count');_0xf7fe30['textContent']='...';try{const _0x24e602=await _0x3ea5ae[_0x2526c4(0x366)]();_0xf7fe30['textContent']=_0x24e602;}catch(_0x13c625){console[_0x2526c4(0x275)](_0x2526c4(0x1e7),_0x13c625),_0xf7fe30[_0x2526c4(0x267)]=_0x2526c4(0x259),_0xf7fe30['title']=_0x2526c4(0x1cc)+_0x13c625['message'];}const _0x1900f0=document[_0x2526c4(0x2c1)]('hly-condensation-results');if(_0x1900f0&&!_0x1900f0[_0x2526c4(0x1f3)][_0x2526c4(0x209)]){const _0x1d18f4=_0x3ea5ae[_0x2526c4(0x292)](),_0x2d572f=await _0x3ea5ae['getCollectionId']();if(_0x1d18f4[_0x2526c4(0x21d)]&&_0x1d18f4[_0x2526c4(0x21d)][_0x2d572f]){const _0x904e6=_0x1d18f4[_0x2526c4(0x21d)][_0x2d572f];_0x1900f0[_0x2526c4(0x2dd)]=_0x2526c4(0x28e)+_0x904e6[_0x2526c4(0x1f4)]+'\x20楼凝识至第\x20'+_0x904e6[_0x2526c4(0x311)]+_0x2526c4(0x23d);}else _0x1900f0[_0x2526c4(0x2dd)]=_0x2526c4(0x29d);}renderKnowledgeBases();}async function moveAllKnowledgeBases(_0x34ad35){const _0x503414=_0x13c5aa,_0x5ec11b=_0x34ad35===_0x503414(0x1e9),_0x4096a7=_0x5ec11b?_0x503414(0x25f):_0x503414(0x206),_0x2b0b27=_0x5ec11b?'局部':'全局',_0xcfd252=_0x5ec11b?_0x3ea5ae[_0x503414(0x39c)]():_0x3ea5ae['getLocalKnowledgeBases'](),_0x36f9dc=Object[_0x503414(0x217)](_0xcfd252);if(_0x36f9dc[_0x503414(0x2b7)]===0x0){toastr[_0x503414(0x239)](_0x503414(0x245)+(_0x5ec11b?'全局':'局部')+_0x503414(0x2b4),'圣谕');return;}if(!confirm(_0x503414(0x2c5)+_0x36f9dc[_0x503414(0x2b7)]+_0x503414(0x1b1)+(_0x5ec11b?'全局':'局部')+_0x503414(0x34c)+_0x2b0b27+'】吗？'))return;log(_0x503414(0x266)+_0x36f9dc[_0x503414(0x2b7)]+_0x503414(0x307)+_0x4096a7+_0x503414(0x224)+(_0x5ec11b?'local':'global')+'...',_0x503414(0x239));const _0x3509b5=_0x36f9dc[_0x503414(0x288)](_0x595db5=>_0x3ea5ae[_0x503414(0x281)](_0x595db5,_0x4096a7));try{await Promise[_0x503414(0x1ca)](_0x3509b5),toastr[_0x503414(0x1ea)](_0x503414(0x1a9)+_0x36f9dc[_0x503414(0x2b7)]+_0x503414(0x1d2),_0x503414(0x32f)),log('批量移动完成。','success');}catch(_0x462c9c){toastr[_0x503414(0x275)](_0x503414(0x299)+_0x462c9c[_0x503414(0x374)],'警报'),log(_0x503414(0x2cc)+_0x462c9c[_0x503414(0x374)],_0x503414(0x275));}finally{await updatePanelStatus();}}async function deleteAllLocalKnowledgeBases(){const _0x520a87=_0x13c5aa,_0x195ef1=_0x3ea5ae[_0x520a87(0x25b)](),_0x1bc36a=Object[_0x520a87(0x217)](_0x195ef1);if(_0x1bc36a[_0x520a87(0x2b7)]===0x0){toastr[_0x520a87(0x239)]('当前角色没有任何局部知识库可供删除。','圣谕');return;}if(!confirm(_0x520a87(0x35f)+_0x1bc36a[_0x520a87(0x2b7)]+_0x520a87(0x342)))return;toastr[_0x520a87(0x239)](_0x520a87(0x20a)+_0x1bc36a['length']+_0x520a87(0x248),'圣旨'),log(_0x520a87(0x241)+_0x1bc36a[_0x520a87(0x2b7)]+_0x520a87(0x248),_0x520a87(0x2da));let _0x31fcf6=0x0,_0x49acb6=0x0;for(const _0x76e219 of _0x1bc36a){try{await _0x3ea5ae[_0x520a87(0x2c2)](_0x76e219,_0x520a87(0x206)),_0x31fcf6++;}catch(_0x531dbc){_0x49acb6++,log(_0x520a87(0x203)+_0x76e219+_0x520a87(0x359)+_0x531dbc[_0x520a87(0x374)],_0x520a87(0x275));}}_0x49acb6>0x0?toastr[_0x520a87(0x275)]('操作完成，但有\x20'+_0x49acb6+'\x20个知识库删除失败。','警报'):toastr[_0x520a87(0x1ea)](_0x520a87(0x1a9)+_0x31fcf6+_0x520a87(0x351),_0x520a87(0x32f)),log(_0x520a87(0x233)+_0x31fcf6+_0x520a87(0x1ce)+_0x49acb6,'info'),await updatePanelStatus();}async function renderKnowledgeBases(){const _0x2e7202=_0x13c5aa,_0x487350=document['getElementById'](_0x2e7202(0x2d7)),_0x251d58=document[_0x2e7202(0x2c1)](_0x2e7202(0x1c2)),_0x443437=document['getElementById'](_0x2e7202(0x25e));if(!_0x487350||!_0x251d58||!_0x443437)return;_0x443437['textContent']=_0x4219f5[_0x2e7202(0x22f)]()||_0x2e7202(0x399);try{const _0x34c004=_0x3ea5ae[_0x2e7202(0x25b)](),_0x6b4049=_0x3ea5ae[_0x2e7202(0x39c)]();await _renderKbList(_0x34c004,_0x487350,_0x2e7202(0x206),_0x2e7202(0x332)),await _renderKbList(_0x6b4049,_0x251d58,_0x2e7202(0x25f),_0x2e7202(0x1ff));}catch(_0x156878){console[_0x2e7202(0x275)](_0x2e7202(0x329),_0x156878),_0x487350[_0x2e7202(0x2dd)]=_0x2e7202(0x228)+_0x156878['message']+'</i></p>',_0x251d58[_0x2e7202(0x2dd)]=_0x2e7202(0x228)+_0x156878[_0x2e7202(0x374)]+_0x2e7202(0x2a2);}}async function _renderKbList(_0x340d09,_0x59d488,_0x1cbc9a,_0x535f2c){const _0x2be4bc=_0x13c5aa,_0x2a1eeb=document[_0x2be4bc(0x2c1)](_0x535f2c);_0x59d488['innerHTML']='',_0x59d488[_0x2be4bc(0x2ab)](_0x2a1eeb);if(Object[_0x2be4bc(0x217)](_0x340d09)['length']===0x0){_0x2a1eeb[_0x2be4bc(0x33c)]['display']=_0x2be4bc(0x243);return;}_0x2a1eeb[_0x2be4bc(0x33c)][_0x2be4bc(0x2c4)]=_0x2be4bc(0x2ff);for(const [_0xabc40e,_0x148d4a]of Object[_0x2be4bc(0x319)](_0x340d09)){const _0x1447e9=document[_0x2be4bc(0x1ac)](_0x2be4bc(0x283));_0x1447e9[_0x2be4bc(0x2c0)]='hly-kb-list-item',_0x1447e9[_0x2be4bc(0x1f3)]['kbId']=_0xabc40e,_0x1447e9[_0x2be4bc(0x1f3)][_0x2be4bc(0x2f7)]=_0x1cbc9a;const _0x4ba837=await _0x3ea5ae['getVectorCount'](_0xabc40e,_0x1cbc9a),_0x4bee33=_0x1cbc9a===_0x2be4bc(0x206)?'<button\x20class=\x22hly-kb-move-btn\x22\x20title=\x22上移到全局\x22><i\x20class=\x22fas\x20fa-arrow-up\x22></i></button>':'<button\x20class=\x22hly-kb-move-btn\x22\x20title=\x22下移到局部\x22><i\x20class=\x22fas\x20fa-arrow-down\x22></i></button>';_0x1447e9[_0x2be4bc(0x2dd)]=_0x2be4bc(0x1e5)+_0xabc40e+_0x2be4bc(0x32a)+_0xabc40e+'\x22>'+_0x148d4a[_0x2be4bc(0x1c4)]+'\x20('+_0x4ba837+_0x2be4bc(0x1e2)+_0x4bee33+_0x2be4bc(0x1a6)+(_0x148d4a[_0x2be4bc(0x331)]?'checked':'')+_0x2be4bc(0x362),_0x59d488[_0x2be4bc(0x2ab)](_0x1447e9);}}async function handleKbAction(_0x181869){const _0x5a1632=_0x13c5aa,_0x216b9f=_0x181869[_0x5a1632(0x350)],_0x29e791=_0x216b9f[_0x5a1632(0x2e4)]('.hly-kb-list-item');if(!_0x29e791)return;const _0x1d2800=_0x29e791['dataset'][_0x5a1632(0x262)],_0x3ccfa2=_0x29e791[_0x5a1632(0x1f3)][_0x5a1632(0x2f7)],_0x598003=_0x29e791[_0x5a1632(0x1a8)]('.hly-kb-name')[_0x5a1632(0x267)]['split']('\x20(')[0x0];if(_0x216b9f[_0x5a1632(0x2ce)][_0x5a1632(0x2cf)](_0x5a1632(0x36f))){if(confirm(_0x5a1632(0x298)+_0x598003+'】吗？此操作无法恢复！'))try{await _0x3ea5ae[_0x5a1632(0x2c2)](_0x1d2800,_0x3ccfa2),log(_0x5a1632(0x279)+_0x598003+_0x5a1632(0x1d1)+_0x1d2800+_0x5a1632(0x36c),_0x5a1632(0x1ea)),toastr[_0x5a1632(0x1ea)](_0x5a1632(0x23f)+_0x598003+_0x5a1632(0x2ee)),await updatePanelStatus();}catch(_0x3e7aff){log(_0x5a1632(0x26c)+_0x598003+_0x5a1632(0x359)+_0x3e7aff[_0x5a1632(0x374)],_0x5a1632(0x275)),toastr[_0x5a1632(0x275)](_0x5a1632(0x346)+_0x3e7aff[_0x5a1632(0x374)]);}}if(_0x216b9f[_0x5a1632(0x2e4)](_0x5a1632(0x230))){const _0xce05a3=_0x3ccfa2===_0x5a1632(0x206)?'全局':'局部';if(confirm(_0x5a1632(0x22b)+_0x598003+_0x5a1632(0x34c)+_0xce05a3+_0x5a1632(0x2ec)))try{await _0x3ea5ae[_0x5a1632(0x281)](_0x1d2800,_0x3ccfa2),await updatePanelStatus();}catch(_0x459609){log(_0x5a1632(0x345)+_0x598003+'\x20失败:\x20'+_0x459609['message'],'error'),toastr[_0x5a1632(0x275)](_0x5a1632(0x2e8)+_0x459609[_0x5a1632(0x374)]);}}if(_0x216b9f['classList'][_0x5a1632(0x2cf)]('hly-kb-toggle')&&_0x181869[_0x5a1632(0x23b)]===_0x5a1632(0x380))try{await _0x3ea5ae[_0x5a1632(0x26d)](_0x1d2800,_0x3ccfa2),log(_0x5a1632(0x279)+_0x598003+_0x5a1632(0x20d),_0x5a1632(0x1ea));}catch(_0x421360){log(_0x5a1632(0x1fb)+_0x598003+'\x20状态失败:\x20'+_0x421360[_0x5a1632(0x374)],_0x5a1632(0x275)),toastr['error'](_0x5a1632(0x2c8)+_0x421360[_0x5a1632(0x374)]),_0x216b9f[_0x5a1632(0x367)]=!_0x216b9f[_0x5a1632(0x367)];}_0x216b9f[_0x5a1632(0x2ce)]['contains']('hly-kb-item-checkbox')&&_0x181869[_0x5a1632(0x23b)]==='change'&&updateBulkActionUI(_0x3ccfa2);}function handleSelectAll(_0x4c849a,_0x27af34){const _0x4e1770=_0x13c5aa,_0x4810cf=_0x4c849a[_0x4e1770(0x350)][_0x4e1770(0x367)],_0x5b731e=document[_0x4e1770(0x2c1)]('hly-kb-list-'+_0x27af34),_0x6db0a1=_0x5b731e['querySelectorAll']('.hly-kb-item-checkbox');_0x6db0a1[_0x4e1770(0x231)](_0x18bbaf=>_0x18bbaf[_0x4e1770(0x367)]=_0x4810cf),updateBulkActionUI(_0x27af34);}function updateBulkActionUI(_0x234a88){const _0x3b98d5=_0x13c5aa,_0x5b9e06=document['getElementById']('hly-kb-list-'+_0x234a88),_0x4684c6=document['getElementById'](_0x3b98d5(0x21a)+_0x234a88),_0x5a859e=document['getElementById']('hly-kb-select-all-'+_0x234a88),_0x782632=_0x5b9e06[_0x3b98d5(0x341)]('.hly-kb-item-checkbox'),_0x43a709=_0x5b9e06[_0x3b98d5(0x341)](_0x3b98d5(0x336)),_0x42e33a=_0x43a709['length'],_0x58e75e=_0x782632[_0x3b98d5(0x2b7)];_0x42e33a>0x0?_0x4684c6[_0x3b98d5(0x33c)][_0x3b98d5(0x2c4)]=_0x3b98d5(0x2d6):_0x4684c6[_0x3b98d5(0x33c)][_0x3b98d5(0x2c4)]=_0x3b98d5(0x2ff);if(_0x58e75e===0x0)_0x5a859e[_0x3b98d5(0x367)]=![],_0x5a859e['indeterminate']=![];else{if(_0x42e33a===_0x58e75e)_0x5a859e[_0x3b98d5(0x367)]=!![],_0x5a859e[_0x3b98d5(0x300)]=![];else _0x42e33a>0x0?(_0x5a859e[_0x3b98d5(0x367)]=![],_0x5a859e['indeterminate']=!![]):(_0x5a859e[_0x3b98d5(0x367)]=![],_0x5a859e['indeterminate']=![]);}}async function handleBulkAction(_0xde07a8,_0x1cae4f){const _0x11f863=_0x13c5aa,_0x29ecde=_0xde07a8['target'][_0x11f863(0x1f3)][_0x11f863(0x31e)];if(!_0x29ecde)return;const _0x30dca6=document[_0x11f863(0x2c1)]('hly-kb-list-'+_0x1cae4f),_0x36e72b=_0x30dca6[_0x11f863(0x341)](_0x11f863(0x336)),_0xa057a9=Array[_0x11f863(0x330)](_0x36e72b)[_0x11f863(0x288)](_0x3968ab=>_0x3968ab[_0x11f863(0x1f3)][_0x11f863(0x262)]);if(_0xa057a9[_0x11f863(0x2b7)]===0x0){toastr[_0x11f863(0x223)](_0x11f863(0x2e3),'圣谕');return;}let _0x546b90='',_0x2481a0,_0x4c1247='';switch(_0x29ecde){case _0x11f863(0x38b):_0x546b90='您确定要永久删除选中的\x20'+_0xa057a9[_0x11f863(0x2b7)]+_0x11f863(0x1c6),_0x2481a0=_0x576eb4=>_0x3ea5ae[_0x11f863(0x2c2)](_0x576eb4,_0x1cae4f),_0x4c1247='成功删除了\x20'+_0xa057a9[_0x11f863(0x2b7)]+_0x11f863(0x28b);break;case _0x11f863(0x2fe):const _0x465dd0=_0x1cae4f===_0x11f863(0x206)?'全局':'局部';_0x546b90=_0x11f863(0x256)+_0xa057a9['length']+'\x20个知识库移动到【'+_0x465dd0+_0x11f863(0x2ec),_0x2481a0=_0x14c64f=>_0x3ea5ae['moveKnowledgeBase'](_0x14c64f,_0x1cae4f),_0x4c1247=_0x11f863(0x2af)+_0xa057a9[_0x11f863(0x2b7)]+'\x20个知识库。';break;case _0x11f863(0x323):_0x546b90='您确定要切换选中的\x20'+_0xa057a9[_0x11f863(0x2b7)]+_0x11f863(0x276),_0x2481a0=_0x33dc13=>_0x3ea5ae[_0x11f863(0x26d)](_0x33dc13,_0x1cae4f),_0x4c1247='成功切换了\x20'+_0xa057a9[_0x11f863(0x2b7)]+_0x11f863(0x1e8);break;default:return;}if(!confirm(_0x546b90))return;toastr[_0x11f863(0x239)]('正在对\x20'+_0xa057a9[_0x11f863(0x2b7)]+_0x11f863(0x338),'圣旨'),log('开始对\x20'+_0xa057a9[_0x11f863(0x2b7)]+_0x11f863(0x1fd)+_0x1cae4f+')\x20执行批量\x20'+_0x29ecde+_0x11f863(0x310),_0x11f863(0x239));try{const _0x3e3a53=_0xa057a9[_0x11f863(0x288)](_0x286683=>_0x2481a0(_0x286683));await Promise[_0x11f863(0x1ca)](_0x3e3a53),toastr[_0x11f863(0x1ea)](_0x4c1247,_0x11f863(0x32f)),log('批量\x20'+_0x29ecde+_0x11f863(0x218),_0x11f863(0x1ea));}catch(_0x3e761d){toastr[_0x11f863(0x275)]('批量操作失败:\x20'+_0x3e761d[_0x11f863(0x374)],'警报'),log('批量\x20'+_0x29ecde+'\x20操作失败:\x20'+_0x3e761d['message'],_0x11f863(0x275));}finally{await updatePanelStatus();}}async function testApi(){const _0x522950=_0x13c5aa;toastr[_0x522950(0x239)]('正在测试神力连接...','圣旨');try{await _0x3ea5ae[_0x522950(0x238)](),toastr['success'](_0x522950(0x1c1),'圣意');}catch(_0x19fb51){toastr[_0x522950(0x275)](_0x522950(0x1fa)+_0x19fb51[_0x522950(0x374)],'警报');}}async function fetchHLYEmbeddingModels(){const _0x12c749=_0x13c5aa,_0x460e69=document[_0x12c749(0x2c1)](_0x12c749(0x2cd)),_0x5bfa64=_0x460e69[_0x12c749(0x31b)];_0x460e69[_0x12c749(0x2dd)]='<option>正在获取...</option>',_0x460e69[_0x12c749(0x39b)]=!![];try{log(_0x12c749(0x30f),_0x12c749(0x239));const _0x241fbd=await _0x3ea5ae[_0x12c749(0x210)]();_0x460e69[_0x12c749(0x2dd)]='';if(_0x241fbd[_0x12c749(0x2b7)]===0x0){_0x460e69[_0x12c749(0x2dd)]=_0x12c749(0x320),toastr[_0x12c749(0x2da)]('未能获取到任何模型。',_0x12c749(0x35a)),log(_0x12c749(0x1c3),_0x12c749(0x2da));return;}_0x241fbd['forEach'](_0x1f2d66=>{const _0x6719ba=_0x12c749,_0xf4bdcc=new Option(_0x1f2d66,_0x1f2d66);_0x460e69[_0x6719ba(0x2e7)](_0xf4bdcc);}),_0x241fbd['includes'](_0x5bfa64)?_0x460e69[_0x12c749(0x31b)]=_0x5bfa64:_0x460e69[_0x12c749(0x302)]=0x0,toastr[_0x12c749(0x1ea)](_0x12c749(0x201)+_0x241fbd['length']+_0x12c749(0x315),'圣意'),log('成功获取\x20'+_0x241fbd['length']+_0x12c749(0x315),_0x12c749(0x1ea));}catch(_0x201546){console[_0x12c749(0x275)](_0x12c749(0x1e4),_0x201546),toastr['error']('获取模型失败:\x20'+_0x201546['message'],_0x12c749(0x295)),log(_0x12c749(0x232)+_0x201546[_0x12c749(0x374)],_0x12c749(0x275)),_0x460e69[_0x12c749(0x2dd)]=_0x12c749(0x200);}finally{_0x460e69[_0x12c749(0x39b)]=![];}}async function fetchHLYRerankModels(){const _0x25cd87=_0x13c5aa,_0x4c4a80=document['getElementById'](_0x25cd87(0x370)),_0x339a14=_0x4c4a80[_0x25cd87(0x31b)];_0x4c4a80[_0x25cd87(0x2dd)]=_0x25cd87(0x1e0),_0x4c4a80[_0x25cd87(0x39b)]=!![];try{log(_0x25cd87(0x2f8),_0x25cd87(0x239));const _0xbb8e94=await _0x3ea5ae['fetchRerankModels']();_0x4c4a80['innerHTML']='';if(_0xbb8e94[_0x25cd87(0x2b7)]===0x0){_0x4c4a80[_0x25cd87(0x2dd)]=_0x25cd87(0x320),toastr[_0x25cd87(0x2da)](_0x25cd87(0x2d3),_0x25cd87(0x35a)),log('未能获取到任何Rerank模型。',_0x25cd87(0x2da));return;}_0xbb8e94[_0x25cd87(0x231)](_0x301f4e=>{const _0x3dfc83=_0x25cd87,_0x6212ff=new Option(_0x301f4e,_0x301f4e);_0x4c4a80[_0x3dfc83(0x2e7)](_0x6212ff);}),_0xbb8e94[_0x25cd87(0x2b1)](_0x339a14)?_0x4c4a80[_0x25cd87(0x31b)]=_0x339a14:_0x4c4a80[_0x25cd87(0x302)]=0x0,toastr['success']('成功获取\x20'+_0xbb8e94['length']+_0x25cd87(0x33d),'圣意'),log('成功获取\x20'+_0xbb8e94['length']+_0x25cd87(0x33d),_0x25cd87(0x1ea));}catch(_0x21da7a){console[_0x25cd87(0x275)](_0x25cd87(0x282),_0x21da7a),toastr[_0x25cd87(0x275)]('获取Rerank模型失败:\x20'+_0x21da7a[_0x25cd87(0x374)],_0x25cd87(0x295)),log('获取Rerank模型失败:\x20'+_0x21da7a[_0x25cd87(0x374)],'error'),_0x4c4a80[_0x25cd87(0x2dd)]=_0x25cd87(0x200);}finally{_0x4c4a80['disabled']=![];}}async function purgeStorage(){const _0x29fe6e=_0x13c5aa;if(confirm(_0x29fe6e(0x1b4))){toastr[_0x29fe6e(0x239)](_0x29fe6e(0x1df),'圣旨');const _0x42fda9=await _0x3ea5ae[_0x29fe6e(0x38f)]();_0x42fda9?toastr[_0x29fe6e(0x1ea)](_0x29fe6e(0x33e),'圣意'):toastr['error']('清空宝库失败。','警报'),await updatePanelStatus();}}async function startCondensation(){const _0x5d4308=_0x13c5aa,_0x334c74=document[_0x5d4308(0x2c1)](_0x5d4308(0x1ab)),_0x1b511b=_0x334c74[_0x5d4308(0x1f3)][_0x5d4308(0x1f7)],_0x1449ca=document[_0x5d4308(0x2c1)](_0x5d4308(0x2c6))[_0x5d4308(0x31b)],_0x444353=document[_0x5d4308(0x2c1)]('hly-layer-end')['value'],_0x751c99={'start':parseInt(_0x1449ca),'end':parseInt(_0x444353)};try{let _0x43f79b;_0x1b511b?(log(_0x5d4308(0x25d),_0x5d4308(0x239)),toastr['info'](_0x5d4308(0x26e),'圣旨'),_0x43f79b=JSON[_0x5d4308(0x280)](_0x1b511b),delete _0x334c74[_0x5d4308(0x1f3)][_0x5d4308(0x1f7)]):(log(_0x5d4308(0x376),_0x5d4308(0x239)),toastr['info']('正在准备凝识...','圣旨'),_0x43f79b=_0x3ea5ae[_0x5d4308(0x24f)]());if(!_0x43f79b||_0x43f79b[_0x5d4308(0x2b7)]===0x0){toastr[_0x5d4308(0x223)](_0x5d4308(0x301),'翰林院启奏'),_0x334c74[_0x5d4308(0x267)]=_0x5d4308(0x390);return;}_0x334c74[_0x5d4308(0x267)]=_0x5d4308(0x363)+_0x43f79b[_0x5d4308(0x2b7)]+_0x5d4308(0x371),toastr['info'](_0x5d4308(0x363)+_0x43f79b['length']+_0x5d4308(0x371),'翰林院启奏');const _0x4057fa=await _0x3ea5ae[_0x5d4308(0x382)](_0x43f79b,log,_0x751c99);if(_0x4057fa[_0x5d4308(0x1ea)]){toastr[_0x5d4308(0x1ea)]('凝识完成！新增\x20'+_0x4057fa[_0x5d4308(0x242)]+_0x5d4308(0x39d),_0x5d4308(0x32f));const _0x216a8f=_0x751c99['end']===0x0?getContext()[_0x5d4308(0x1da)][_0x5d4308(0x2b7)]:_0x751c99[_0x5d4308(0x311)];_0x334c74[_0x5d4308(0x267)]=_0x5d4308(0x309)+_0x751c99['start']+'\x20楼到第\x20'+_0x216a8f+_0x5d4308(0x28f)+_0x4057fa[_0x5d4308(0x242)]+_0x5d4308(0x39d);}else throw new Error(_0x4057fa[_0x5d4308(0x275)]||_0x5d4308(0x21b));}catch(_0x43dcd4){console[_0x5d4308(0x275)](_0x5d4308(0x29e),_0x43dcd4),toastr[_0x5d4308(0x275)](_0x5d4308(0x2bc)+_0x43dcd4[_0x5d4308(0x374)],_0x5d4308(0x295)),_0x334c74[_0x5d4308(0x267)]=_0x5d4308(0x2bc)+_0x43dcd4[_0x5d4308(0x374)];}finally{await updatePanelStatus();}}async function loadWorldbookList(){const _0x263652=_0x13c5aa,_0x4384e2=document[_0x263652(0x2c1)](_0x263652(0x27f)),_0x467d9a=document[_0x263652(0x2c1)](_0x263652(0x24c));if(!_0x4384e2)return;try{log(_0x263652(0x2cb),'info');const _0x1357da=await _0x39aed7[_0x263652(0x20e)]();window[_0x263652(0x264)]=_0x1357da,updateWorldbookOptions(_0x4384e2,'',_0x1357da);if(_0x467d9a){const _0x243f14=debounce(_0xfffe18=>{updateWorldbookOptions(_0x4384e2,_0xfffe18,_0x1357da);},0x12c);_0x467d9a[_0x263652(0x29f)](_0x263652(0x23e),_0x300022=>{const _0x48ee0d=_0x263652;_0x243f14(_0x300022[_0x48ee0d(0x350)]['value']);});}log(_0x263652(0x296)+_0x1357da[_0x263652(0x2b7)]+_0x263652(0x2ea),_0x263652(0x1ea));}catch(_0x553955){console[_0x263652(0x275)](_0x263652(0x368),_0x553955),log(_0x263652(0x306)+_0x553955['message'],_0x263652(0x275)),_0x4384e2&&(_0x4384e2[_0x263652(0x2dd)]='<option\x20value=\x22\x22>加载失败</option>');}}function updateWorldbookOptions(_0x5c9e2e,_0x3b7854,_0x1bf982){const _0x20e6d1=_0x13c5aa,_0x3a0525=filterWorldbooks(_0x3b7854,_0x1bf982),_0x3c496c=_0x5c9e2e[_0x20e6d1(0x31b)];_0x5c9e2e[_0x20e6d1(0x2dd)]='<option\x20value=\x22\x22>请选择一个书库...</option>';if(_0x3a0525[_0x20e6d1(0x2b7)]===0x0){_0x5c9e2e['innerHTML']=_0x3b7854['trim']()?_0x20e6d1(0x2a4):'<option\x20value=\x22\x22>未找到任何书库</option>';return;}_0x3a0525[_0x20e6d1(0x231)](_0x4f694d=>{const _0x500901=_0x20e6d1,_0x563979=document[_0x500901(0x1ac)](_0x500901(0x2de));_0x563979[_0x500901(0x31b)]=_0x4f694d,_0x563979[_0x500901(0x267)]=_0x4f694d,_0x5c9e2e['appendChild'](_0x563979);}),_0x3c496c&&_0x3a0525[_0x20e6d1(0x2b1)](_0x3c496c)&&(_0x5c9e2e[_0x20e6d1(0x31b)]=_0x3c496c);}async function handleWorldbookSelectionChange(){const _0x282e3a=_0x13c5aa,_0x1309b4=document[_0x282e3a(0x2c1)](_0x282e3a(0x27f)),_0x37f4ae=document[_0x282e3a(0x2c1)](_0x282e3a(0x396)),_0x846d6=document[_0x282e3a(0x2c1)](_0x282e3a(0x1cd)),_0x5c58aa=document[_0x282e3a(0x2c1)](_0x282e3a(0x1f0)),_0x247d5c=_0x1309b4[_0x282e3a(0x31b)];_0x37f4ae[_0x282e3a(0x39b)]=!![],_0x37f4ae[_0x282e3a(0x1a8)](_0x282e3a(0x2c7))[_0x282e3a(0x267)]=_0x282e3a(0x286),_0x846d6[_0x282e3a(0x2dd)]='',_0x846d6[_0x282e3a(0x33c)][_0x282e3a(0x2c4)]='none';_0x5c58aa&&(_0x5c58aa[_0x282e3a(0x31b)]='');if(!_0x247d5c){_0x37f4ae[_0x282e3a(0x1a8)](_0x282e3a(0x2c7))['textContent']=_0x282e3a(0x1c7);return;}try{log('正在为《'+_0x247d5c+_0x282e3a(0x237),_0x282e3a(0x239));const _0x5989d9=await _0x39aed7[_0x282e3a(0x1d3)](_0x247d5c);if(_0x5989d9['length']===0x0){_0x37f4ae[_0x282e3a(0x1a8)](_0x282e3a(0x2c7))['textContent']='此书库为空';return;}window[_0x282e3a(0x1a5)]=_0x5989d9,updateEntryOptions('',_0x5989d9);if(_0x5c58aa){_0x5c58aa[_0x282e3a(0x352)](_0x282e3a(0x23e),_0x5c58aa[_0x282e3a(0x308)]);const _0x426d22=debounce(_0x2bdb0c=>{updateEntryOptions(_0x2bdb0c,_0x5989d9);},0x12c);_0x5c58aa[_0x282e3a(0x308)]=_0x1c1c88=>{const _0x3c14fb=_0x282e3a;_0x426d22(_0x1c1c88[_0x3c14fb(0x350)][_0x3c14fb(0x31b)]);},_0x5c58aa[_0x282e3a(0x29f)]('input',_0x5c58aa[_0x282e3a(0x308)]);}log('成功加载\x20'+_0x5989d9['length']+_0x282e3a(0x2a1),_0x282e3a(0x1ea));}catch(_0x553e19){console[_0x282e3a(0x275)](_0x282e3a(0x316)+_0x247d5c+_0x282e3a(0x1ae),_0x553e19),log('加载条目失败:\x20'+_0x553e19[_0x282e3a(0x374)],_0x282e3a(0x275)),_0x37f4ae[_0x282e3a(0x1a8)](_0x282e3a(0x2c7))[_0x282e3a(0x267)]=_0x282e3a(0x261);}finally{_0x37f4ae[_0x282e3a(0x39b)]=![];}}function updateEntryOptions(_0x4c2a23,_0x59611c){const _0x22e596=_0x13c5aa,_0x37cd66=document[_0x22e596(0x2c1)](_0x22e596(0x1cd)),_0x243b47=document[_0x22e596(0x2c1)](_0x22e596(0x396)),_0x465b5c=filterWorldbookEntries(_0x4c2a23,_0x59611c);_0x37cd66[_0x22e596(0x2dd)]='';const _0x573e35=_0x22e596(0x1ee);_0x37cd66[_0x22e596(0x234)](_0x22e596(0x2a3),_0x573e35);if(_0x465b5c[_0x22e596(0x2b7)]===0x0){const _0xa49f68=_0x22e596(0x1bb);_0x37cd66[_0x22e596(0x234)](_0x22e596(0x2a3),_0xa49f68),_0x243b47['querySelector'](_0x22e596(0x2c7))[_0x22e596(0x267)]=_0x22e596(0x31f);return;}_0x465b5c[_0x22e596(0x231)](_0x4c90ae=>{const _0xc19318=_0x22e596,_0x54496e=_0x4c2a23?highlightSearchMatch(_0x4c90ae['comment'],_0x4c2a23):_0x4c90ae['comment'],_0x2e8620=_0xc19318(0x291)+_0x4c90ae['comment']+_0xc19318(0x1ec)+_0x4c90ae['key']+_0xc19318(0x38d)+_0x4c90ae[_0xc19318(0x21e)]+_0xc19318(0x2e2)+_0x54496e+_0xc19318(0x2a7);_0x37cd66[_0xc19318(0x234)](_0xc19318(0x2a3),_0x2e8620);}),_0x243b47[_0x22e596(0x1a8)](_0x22e596(0x2c7))['textContent']=_0x22e596(0x1c5)+_0x465b5c[_0x22e596(0x2b7)]+'\x20个条目';}async function startHistoriography(){const _0x15ffae=_0x13c5aa,_0x3b0e3f=document['getElementById'](_0x15ffae(0x27f))[_0x15ffae(0x31b)],_0xbfd93=document[_0x15ffae(0x2c1)](_0x15ffae(0x1cd)),_0x6f6609=document[_0x15ffae(0x2c1)](_0x15ffae(0x1f1)),_0x3319f6=Array[_0x15ffae(0x330)](_0xbfd93['querySelectorAll']('.hly-hist-entry-checkbox:checked'))[_0x15ffae(0x288)](_0x1b780e=>_0x1b780e[_0x15ffae(0x31b)]);if(!_0x3b0e3f||_0x3319f6['length']===0x0){toastr[_0x15ffae(0x223)](_0x15ffae(0x321),_0x15ffae(0x2a0));return;}_0x6f6609[_0x15ffae(0x267)]=_0x15ffae(0x274)+_0x3b0e3f+_0x15ffae(0x2d0)+_0x3319f6[_0x15ffae(0x2b7)]+'\x20个条目进行批量编纂...',toastr['info'](_0x15ffae(0x2e0),'圣旨'),log(_0x15ffae(0x221)+_0x3b0e3f+'》中的\x20'+_0x3319f6['length']+_0x15ffae(0x387),_0x15ffae(0x239));try{const _0x28d296=await _0x39aed7[_0x15ffae(0x269)](_0x3b0e3f,_0x3319f6);_0x6f6609[_0x15ffae(0x267)]=_0x28d296[_0x15ffae(0x2b8)],_0x28d296[_0x15ffae(0x1ea)]?toastr[_0x15ffae(0x1ea)](_0x15ffae(0x393),_0x15ffae(0x32f)):toastr[_0x15ffae(0x223)](_0x15ffae(0x215),'圣谕'),log('对《'+_0x3b0e3f+_0x15ffae(0x33a)+_0x28d296[_0x15ffae(0x337)]+_0x15ffae(0x312)+_0x28d296[_0x15ffae(0x343)],_0x15ffae(0x1ea));}catch(_0x5b5713){console[_0x15ffae(0x275)](_0x15ffae(0x358),_0x5b5713),toastr[_0x15ffae(0x275)](_0x15ffae(0x289)+_0x5b5713['message'],_0x15ffae(0x295)),_0x6f6609[_0x15ffae(0x267)]='编纂失败:\x20'+_0x5b5713[_0x15ffae(0x374)];}finally{await updatePanelStatus();}}async function showStats(){const _0x2088c3=_0x13c5aa;try{log('用户请求查看宝库状态。',_0x2088c3(0x239)),toastr['info']('正在查询宝库状态...','圣旨');const _0x10be24=await _0x3ea5ae[_0x2088c3(0x366)](),_0x17c7e5=await _0x3ea5ae[_0x2088c3(0x1d9)](),_0x3ed6e3=_0x3ea5ae[_0x2088c3(0x292)](),_0x32d49c='\x0a<pre>\x0a翰林院宝库状态\x0a--------------------\x0a集合ID:\x20'+_0x17c7e5+_0x2088c3(0x219)+_0x10be24+_0x2088c3(0x335)+_0x3ed6e3[_0x2088c3(0x247)][_0x2088c3(0x2fb)]+_0x2088c3(0x2a5)+_0x3ed6e3[_0x2088c3(0x247)][_0x2088c3(0x386)]+_0x2088c3(0x356);toastr[_0x2088c3(0x239)](_0x32d49c,'宝库状态',{'timeOut':0x3a98,'extendedTimeOut':0x1388,'tapToDismiss':!![],'closeButton':!![]}),log('查看宝库状态成功：集合ID='+_0x17c7e5+_0x2088c3(0x1a7)+_0x10be24,_0x2088c3(0x1ea));}catch(_0x174fea){console[_0x2088c3(0x275)](_0x2088c3(0x2ac),_0x174fea),toastr[_0x2088c3(0x275)]('查询宝库状态失败:\x20'+_0x174fea[_0x2088c3(0x374)],_0x2088c3(0x295)),log(_0x2088c3(0x31a)+_0x174fea[_0x2088c3(0x374)],_0x2088c3(0x275));}}function showExclusionRulesModal(){const _0x20f51a=_0x13c5aa,_0x552b03=_0x3ea5ae['getSettings'](),_0x5ebf60=_0x552b03[_0x20f51a(0x23c)]['exclusionRules']||[],_0x60a6d7=(_0x1fa25f={'start':'','end':''},_0x46d2c6)=>'\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22hly-exclusion-rule-row\x22\x20data-index=\x22'+_0x46d2c6+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20class=\x22hly-imperial-brush\x22\x20value=\x22'+_0x1fa25f[_0x20f51a(0x1f4)]+_0x20f51a(0x1a1)+_0x1fa25f[_0x20f51a(0x311)]+'\x22\x20placeholder=\x22结束字符,\x20如\x20-->\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22hly-delete-rule-btn\x22\x20title=\x22删除此规则\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20',_0x4963e1=_0x5ebf60['map'](_0x60a6d7)[_0x20f51a(0x2c3)](''),_0x32d4d4='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22hly-exclusion-rules-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22hly-notes\x22>在这里定义需要从提取内容中排除的文本片段。例如，排除HTML注释，可以设置开始字符为\x20`<!--`，结束字符为\x20`-->`。</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22hly-rules-list\x22>'+_0x4963e1+_0x20f51a(0x392);showHtmlModal('编辑内容排除规则',_0x32d4d4,{'okText':'保存规则','onOk':_0x44c19c=>{const _0xcf3c95=_0x20f51a,_0x6ee4f1=[];_0x44c19c[_0xcf3c95(0x397)](_0xcf3c95(0x2f2))['each'](function(){const _0x14c552=_0xcf3c95,_0x10f34d=$(this)[_0x14c552(0x397)](_0x14c552(0x23e))['eq'](0x0)['val']()[_0x14c552(0x322)](),_0x3154b9=$(this)[_0x14c552(0x397)](_0x14c552(0x23e))['eq'](0x1)[_0x14c552(0x378)]()[_0x14c552(0x322)]();_0x10f34d&&_0x3154b9&&_0x6ee4f1[_0x14c552(0x325)]({'start':_0x10f34d,'end':_0x3154b9});}),updateAndSaveSetting(_0xcf3c95(0x2c9),_0x6ee4f1),toastr[_0xcf3c95(0x1ea)](_0xcf3c95(0x2bf),_0xcf3c95(0x1dc));}});const _0x1bdae1=document[_0x20f51a(0x2c1)](_0x20f51a(0x327)),_0x4780c4=_0x1bdae1[_0x20f51a(0x1a8)](_0x20f51a(0x29b));_0x1bdae1[_0x20f51a(0x1a8)](_0x20f51a(0x270))['addEventListener'](_0x20f51a(0x273),()=>{const _0x5dc824=_0x20f51a,_0x41ff0e=_0x4780c4[_0x5dc824(0x2aa)][_0x5dc824(0x2b7)],_0x1712e0=_0x60a6d7({'start':'','end':''},_0x41ff0e);_0x4780c4['insertAdjacentHTML'](_0x5dc824(0x2a3),_0x1712e0);}),_0x4780c4['addEventListener']('click',_0x387845=>{const _0x4187bb=_0x20f51a;_0x387845['target'][_0x4187bb(0x2ce)][_0x4187bb(0x2cf)](_0x4187bb(0x2e5))&&_0x387845[_0x4187bb(0x350)]['closest']('.hly-exclusion-rule-row')[_0x4187bb(0x1cb)]();});}function previewCondensation(){const _0x81c39d=_0x13c5aa,_0x1d0fd1=document[_0x81c39d(0x2c1)]('hly-condensation-results');try{const _0x118734=_0x3ea5ae[_0x81c39d(0x292)](),_0x349fb4=_0x118734[_0x81c39d(0x23c)]['exclusionRules']||[],_0x535657={'user':document[_0x81c39d(0x2c1)](_0x81c39d(0x33b))[_0x81c39d(0x367)],'ai':document[_0x81c39d(0x2c1)](_0x81c39d(0x216))[_0x81c39d(0x367)]},_0x133ede=document[_0x81c39d(0x2c1)](_0x81c39d(0x22e))[_0x81c39d(0x367)],_0x22e611=_0x133ede?document['getElementById'](_0x81c39d(0x29a))['value']['split'](',')[_0x81c39d(0x288)](_0xafe4f7=>_0xafe4f7[_0x81c39d(0x322)]())[_0x81c39d(0x2d1)](Boolean):[],_0x5c94bd=_0x3ea5ae['getMessagesForCondensation'](_0x535657);if(!_0x5c94bd||_0x5c94bd[_0x81c39d(0x2b7)]===0x0){_0x1d0fd1['textContent']=_0x81c39d(0x268),toastr['warning'](_0x81c39d(0x390),_0x81c39d(0x35a));return;}const _0x5b7d3e=getContext()[_0x81c39d(0x1da)],_0x104de7=_0x5c94bd['map']((_0x25c477,_0x2dfcf0)=>{const _0xd5f7d0=_0x81c39d;let _0x466c19;if(_0x25c477['is_user'])_0x466c19=_0x25c477[_0xd5f7d0(0x30a)];else{if(_0x133ede&&_0x22e611[_0xd5f7d0(0x2b7)]>0x0){const _0x3fe09d=extractBlocksByTags(_0x25c477[_0xd5f7d0(0x30a)],_0x22e611);_0x466c19=_0x3fe09d[_0xd5f7d0(0x2c3)]('\x0a\x0a');}else _0x466c19=_0x25c477['mes'];_0x466c19=applyExclusionRules(_0x466c19,_0x349fb4);}const _0x157fd3=_0x5b7d3e[_0xd5f7d0(0x26f)](_0x5996d3=>_0x5996d3===_0x25c477),_0x54f592=_0x157fd3!==-0x1?_0x157fd3+0x1:-0x1;return{'id':_0xd5f7d0(0x2f0)+_0x2dfcf0,'name':_0x25c477[_0xd5f7d0(0x1c4)],'content':_0x466c19[_0xd5f7d0(0x322)](),'floor':_0x54f592,'is_user':_0x25c477['is_user'],'send_date':_0x25c477[_0xd5f7d0(0x30d)]};})[_0x81c39d(0x2d1)](_0x2a8117=>_0x2a8117['content']);if(_0x104de7['length']===0x0){_0x1d0fd1[_0x81c39d(0x267)]=_0x81c39d(0x1f6),toastr[_0x81c39d(0x223)]('根据标签提取或内容排除条件，未找到任何有效内容。','翰林院启奏');return;}const _0x1d6eaf=_0x104de7['map']((_0xf4dbe5,_0x573043)=>'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22hly-preview-item-v2\x22\x20id=\x22'+_0xf4dbe5['id']+_0x81c39d(0x37b)+_0xf4dbe5[_0x81c39d(0x21c)]+_0x81c39d(0x379)+_0xf4dbe5[_0x81c39d(0x1c4)]+_0x81c39d(0x278)+_0xf4dbe5[_0x81c39d(0x21c)]+_0x81c39d(0x388)+_0xf4dbe5[_0x81c39d(0x389)]+_0x81c39d(0x37c)+_0xf4dbe5[_0x81c39d(0x30d)]+'\x22>'+_0xf4dbe5['content']+'</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</details>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22hly-preview-delete-btn-v2\x22\x20data-target=\x22'+_0xf4dbe5['id']+'\x22\x20title=\x22删除此条\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20')[_0x81c39d(0x2c3)]('');showHtmlModal(_0x81c39d(0x27a),_0x81c39d(0x235)+_0x1d6eaf+'</div>',{'okText':_0x81c39d(0x252),'onOk':_0x476935=>{const _0x126247=_0x81c39d,_0x1d84ac=[];_0x476935['find']('.hly-preview-item-v2')['each'](function(){const _0x59c4bf=_0x46ab,_0x2f6950=$(this)[_0x59c4bf(0x397)]('.hly-preview-textarea'),_0x51f124=_0x2f6950[_0x59c4bf(0x378)]();_0x51f124[_0x59c4bf(0x322)]()&&_0x1d84ac[_0x59c4bf(0x325)]({'mes':_0x51f124,'is_user':_0x2f6950[_0x59c4bf(0x304)](_0x59c4bf(0x1a4)),'send_date':_0x2f6950[_0x59c4bf(0x304)](_0x59c4bf(0x1b6)),'floor':_0x2f6950['data'](_0x59c4bf(0x21c))});}),_0x1d0fd1[_0x126247(0x1f3)][_0x126247(0x1f7)]=JSON[_0x126247(0x28d)](_0x1d84ac);const _0x5965e9=document[_0x126247(0x2c1)](_0x126247(0x2c6))[_0x126247(0x31b)],_0x34e1b4=document[_0x126247(0x2c1)](_0x126247(0x381))[_0x126247(0x31b)];_0x1d0fd1[_0x126247(0x267)]=_0x126247(0x2eb)+_0x5965e9+_0x126247(0x226)+_0x34e1b4+'\x20楼的内容（共\x20'+_0x1d84ac[_0x126247(0x2b7)]+_0x126247(0x314),toastr['success'](_0x126247(0x347),'圣旨已达');}}),$(_0x81c39d(0x2fd))['on']('click',function(_0x1fdb73){const _0x39e4eb=_0x81c39d;_0x1fdb73[_0x39e4eb(0x20f)]();const _0x59f6b3=$(this)['data'](_0x39e4eb(0x350));$('#'+_0x59f6b3)[_0x39e4eb(0x1cb)]();});}catch(_0x1ac6f9){console['error'](_0x81c39d(0x23a),_0x1ac6f9),_0x1d0fd1['textContent']=_0x81c39d(0x1c8)+_0x1ac6f9['message'],toastr['error'](_0x81c39d(0x1c8)+_0x1ac6f9[_0x81c39d(0x374)],_0x81c39d(0x295));}}function _0x46ab(_0x1d1517,_0x14bd99){const _0x26e1e1=_0x26e1();return _0x46ab=function(_0x46ab60,_0x28dc1f){_0x46ab60=_0x46ab60-0x1a1;let _0x2c353d=_0x26e1e1[_0x46ab60];return _0x2c353d;},_0x46ab(_0x1d1517,_0x14bd99);}function log(_0xb1ce57,_0x5f470a='info'){const _0x17349b=_0x13c5aa,_0x76705c=document['getElementById']('hly-log-output');if(!_0x76705c)return;const _0xdfc310=document[_0x17349b(0x1ac)]('p'),_0x534a6c=new Date()[_0x17349b(0x2bd)]();let _0x238f63=_0x17349b(0x1d0),_0x371921=_0x17349b(0x26a);switch(_0x5f470a){case'success':_0x238f63='fa-check-circle',_0x371921=_0x17349b(0x205);break;case _0x17349b(0x275):_0x238f63=_0x17349b(0x251),_0x371921=_0x17349b(0x39a);break;case'warn':_0x238f63=_0x17349b(0x36a),_0x371921=_0x17349b(0x1a3);break;}_0xdfc310[_0x17349b(0x2c0)]=_0x17349b(0x28a)+_0x371921,_0xdfc310[_0x17349b(0x2dd)]=_0x17349b(0x213)+_0x238f63+'\x22></i>\x20['+_0x534a6c+']\x20'+_0xb1ce57;const _0x3a997a=_0x76705c[_0x17349b(0x1a8)](_0x17349b(0x1f2));_0x3a997a&&_0x3a997a[_0x17349b(0x1cb)](),_0x76705c[_0x17349b(0x2ab)](_0xdfc310),_0x76705c[_0x17349b(0x37e)]=_0x76705c[_0x17349b(0x1bd)];}async function ingestManualText(){const _0x199cc5=_0x13c5aa,_0x2b971a=document[_0x199cc5(0x2c1)](_0x199cc5(0x340)),_0x2a4c37=_0x2b971a[_0x199cc5(0x31b)][_0x199cc5(0x322)]();if(!_0x2a4c37){toastr[_0x199cc5(0x223)](_0x199cc5(0x27b),_0x199cc5(0x35a)),log(_0x199cc5(0x1d4),_0x199cc5(0x2da));return;}log(_0x199cc5(0x1b3)+_0x2a4c37[_0x199cc5(0x2b7)],_0x199cc5(0x239)),toastr[_0x199cc5(0x239)](_0x199cc5(0x1f8),'圣旨');try{const _0x531305=await _0x3ea5ae[_0x199cc5(0x227)](_0x2a4c37,_0x199cc5(0x1ba),{'sourceName':_0x199cc5(0x1db)});if(_0x531305[_0x199cc5(0x1ea)])toastr['success'](_0x199cc5(0x1ed)+_0x531305['count']+_0x199cc5(0x39d),_0x199cc5(0x32f)),log(_0x199cc5(0x22a)+_0x531305['count']+_0x199cc5(0x39d),_0x199cc5(0x1ea)),_0x2b971a[_0x199cc5(0x31b)]='';else throw new Error(_0x531305[_0x199cc5(0x275)]||_0x199cc5(0x21b));}catch(_0x344687){console[_0x199cc5(0x275)](_0x199cc5(0x2d2),_0x344687),toastr[_0x199cc5(0x275)](_0x199cc5(0x260)+_0x344687[_0x199cc5(0x374)],_0x199cc5(0x295)),log('手动录入失败:\x20'+_0x344687['message'],_0x199cc5(0x275));}finally{await updatePanelStatus();}}
